<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åšå®¢ - DevBlog</title>
  <link rel="stylesheet" href="/css/blog.css">
  <link rel="stylesheet" href="/css/blog-unified.css">
  <style>
    /* åŸƒåŠä¸»é¢˜èƒŒæ™¯ */
    .particles-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
      background: linear-gradient(180deg, #fef9f3 0%, #fff 50%, #f9fafb 100%);
    }
    
    /* é‡‘å­—å¡”è£…é¥° */
    .particles-background::before {
      content: '';
      position: absolute;
      top: 10%;
      right: 5%;
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.03) 0%, rgba(217, 119, 6, 0.01) 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      opacity: 0.5;
      animation: float 30s infinite ease-in-out;
    }
    
    .particles-background::after {
      content: '';
      position: absolute;
      bottom: 15%;
      left: 8%;
      width: 150px;
      height: 150px;
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.02) 0%, rgba(217, 119, 6, 0.005) 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      opacity: 0.4;
      animation: float 25s infinite ease-in-out reverse;
    }
    
    .particle {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(217, 119, 6, 0.08) 0%, rgba(217, 119, 6, 0.02) 100%);
      animation: float 20s infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
  </style>
</head>
<body class="blog-page">
  <!-- ç²’å­èƒŒæ™¯ -->
  <div class="particles-background" id="particles"></div>

  <!-- å¯¼èˆªæ  -->
  <nav class="blog-nav">
    <div class="blog-nav-content">
      <a href="/blog.html" class="blog-logo">
        <div class="blog-logo-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor" opacity="0.9"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>åŸƒæ—…å°å·¥å…·</span>
      </a>
      <div class="blog-nav-actions">
        <div class="blog-search">
          <input 
            type="text" 
            class="blog-search-input" 
            id="searchInput"
            placeholder="æœç´¢æ–‡ç« ..."
            onkeypress="handleSearchKeyPress(event)"
          >
        </div>
        <a href="/blog-admin.html" class="blog-btn blog-btn-secondary blog-btn-sm">ç®¡ç†</a>
      </div>
    </div>
  </nav>

  <!-- é¦–é¡µæ ‡é¢˜åŒºåŸŸ -->
  <section class="blog-hero">
    <h1>åŸƒæ—…å°å·¥å…·<span style="background: linear-gradient(to right, #d97706, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">åšå®¢ç«¯</span></h1>
    <p>åŸƒåŠæœ€å¥½ç”¨çš„å°å·¥å…·ï¼</p>
    <div class="blog-hero-actions">
      <a href="#posts" class="blog-btn blog-btn-primary">æµè§ˆæ–‡ç« </a>
      <a href="#archive" class="blog-btn blog-btn-secondary">æ–‡ç« å½’æ¡£</a>
    </div>
  </section>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <div class="blog-main-layout">
    <!-- å·¦ä¾§åˆ†ç±» -->
    <aside class="blog-sidebar blog-sidebar-left">
      <div class="blog-taxonomy-card">
        <h2 class="blog-taxonomy-title">åˆ†ç±»</h2>
        <div class="blog-taxonomy-list" id="categoriesList">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </aside>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <main class="blog-content">
      <!-- æ ‡ç­¾ç­›é€‰å™¨ï¼ˆé¡¶éƒ¨ï¼‰ -->
      <div class="blog-tags-filter">
        <div class="blog-tags-filter-label">æ ‡ç­¾ç­›é€‰ï¼š</div>
        <div class="blog-tags-filter-list" id="tagsList">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <!-- æ–‡ç« åˆ—è¡¨ -->
      <section id="posts" class="blog-posts-section">
        <div class="blog-posts-grid" id="postsGrid">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
        <div class="blog-pagination" id="pagination"></div>
      </section>

      <!-- æ–‡ç« å½’æ¡£ -->
      <section id="archive" class="blog-posts-section" style="display: none;">
        <div class="blog-archive-container" id="archiveContainer">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
      </section>
    </main>
  </div>

  <!-- é¡µè„š -->
  <footer class="blog-footer">
    <div class="blog-footer-content">
      <div class="blog-footer-text">Â© 2024 DevBlog. All rights reserved.</div>
      <div class="blog-footer-links">
        <a href="/feed.xml" class="blog-footer-link" title="RSS è®¢é˜…">RSS</a>
      </div>
    </div>
  </footer>

  <!-- è„šæœ¬ -->
  <script src="/utils/blog.js"></script>
  <script>
    // å½“å‰é¡µç 
    let currentPage = 1;
    const pageSize = 6;
    let totalPages = 1;
    let currentCategory = null;
    let currentTag = null;
    let currentSearch = null;
    let viewMode = 'posts'; // 'posts' æˆ– 'archive'
    let isAdminLoggedIn = false; // ç®¡ç†å‘˜ç™»å½•çŠ¶æ€

    // åˆå§‹åŒ–ç²’å­èƒŒæ™¯
    function initParticles() {
      const container = document.getElementById('particles');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 100 + 50;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.opacity = Math.random() * 0.3 + 0.1;
        container.appendChild(particle);
      }
    }

    // åŠ è½½æ–‡ç« åˆ—è¡¨
    async function loadPosts(page = 1) {
      try {
        const options = {
          page,
          pageSize,
          published: 'true'
        };
        
        if (currentCategory) {
          options.category = currentCategory;
        }
        if (currentTag) {
          options.tag = currentTag;
        }
        if (currentSearch) {
          options.search = currentSearch;
        }
        
        const response = await getPosts(options);
        
        if (response.success) {
          displayPosts(response.data);
          currentPage = response.pagination.currentPage;
          totalPages = response.pagination.totalPages;
          displayPagination();
          // æ›´æ–°ç¼–è¾‘æŒ‰é’®æ˜¾ç¤º
          if (isAdminLoggedIn) {
            updateEditButtons();
          }
        } else {
          showToast('åŠ è½½æ–‡ç« å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
        showToast('åŠ è½½æ–‡ç« å¤±è´¥: ' + error.message, 'error');
        document.getElementById('postsGrid').innerHTML = '<div class="blog-empty">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
      }
    }

    // åŠ è½½å½’æ¡£æ–‡ç« ï¼ˆæŒ‰æ—¶é—´åˆ†ç»„ï¼‰
    async function loadArchive() {
      try {
        // æ„å»ºæŸ¥è¯¢é€‰é¡¹
        const options = {
          published: 'true',
          pageSize: 10000
        };
        
        // åº”ç”¨åˆ†ç±»ç­›é€‰
        if (currentCategory) {
          options.category = currentCategory;
        }
        
        // åº”ç”¨æ ‡ç­¾ç­›é€‰
        if (currentTag) {
          options.tag = currentTag;
        }
        
        // åº”ç”¨æœç´¢
        if (currentSearch) {
          options.search = currentSearch;
        }
        
        // è·å–æ‰€æœ‰æ–‡ç« ï¼ˆä½¿ç”¨ä¸€ä¸ªå¾ˆå¤§çš„pageSizeï¼Œè¶³å¤Ÿè·å–æ‰€æœ‰æ–‡ç« ï¼‰
        const response = await getPosts(options);
        
        if (response.success) {
          displayArchive(response.data || []);
          // æ›´æ–°ç¼–è¾‘æŒ‰é’®æ˜¾ç¤º
          if (isAdminLoggedIn) {
            updateEditButtons();
          }
        } else {
          showToast('åŠ è½½å½’æ¡£å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('åŠ è½½å½’æ¡£å¤±è´¥:', error);
        showToast('åŠ è½½å½’æ¡£å¤±è´¥: ' + error.message, 'error');
        document.getElementById('archiveContainer').innerHTML = '<div class="blog-empty">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
      }
    }

    // æ˜¾ç¤ºå½’æ¡£æ–‡ç« ï¼ˆæŒ‰æ—¶é—´åˆ†ç»„ï¼‰
    function displayArchive(posts) {
      const container = document.getElementById('archiveContainer');
      
      if (!posts || posts.length === 0) {
        let emptyMessage = '<div class="blog-empty">æš‚æ— æ–‡ç« </div>';
        
        // å¦‚æœæœ‰ç­›é€‰æ¡ä»¶ï¼Œæ˜¾ç¤ºæ¸…é™¤ç­›é€‰çš„æç¤º
        if (currentCategory || currentTag || currentSearch) {
          emptyMessage = `
            <div class="blog-empty">
              <div style="margin-bottom: 1rem;">æš‚æ— ç¬¦åˆæ¡ä»¶çš„æ–‡ç« </div>
              <button onclick="clearFilters()" style="padding: 0.5rem 1rem; background: #9333ea; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                æ¸…é™¤ç­›é€‰æ¡ä»¶
              </button>
            </div>
          `;
        }
        
        container.innerHTML = emptyMessage;
        return;
      }

      // æ˜¾ç¤ºç­›é€‰çŠ¶æ€
      let filterInfo = '';
      if (currentCategory || currentTag || currentSearch) {
        const filters = [];
        if (currentCategory) filters.push(`åˆ†ç±»: ${currentCategory}`);
        if (currentTag) filters.push(`æ ‡ç­¾: ${currentTag}`);
        if (currentSearch) filters.push(`æœç´¢: ${currentSearch}`);
        
        filterInfo = `
          <div style="margin-bottom: 2rem; padding: 1rem; background: #f3f4f6; border-radius: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <span style="color: #6b7280; font-size: 0.875rem;">ç­›é€‰æ¡ä»¶: </span>
              <span style="color: #1f2937; font-weight: 500;">${filters.join(' â€¢ ')}</span>
              <span style="color: #6b7280; font-size: 0.875rem; margin-left: 1rem;">å…± ${posts.length} ç¯‡æ–‡ç« </span>
            </div>
            <button onclick="clearFilters()" style="padding: 0.5rem 1rem; background: #9333ea; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem;">
              æ¸…é™¤ç­›é€‰
            </button>
          </div>
        `;
      }

      // æŒ‰å¹´æœˆåˆ†ç»„
      const groupedByYearMonth = {};
      posts.forEach(post => {
        const date = new Date(post.createdAt || post.created_at || Date.now());
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const yearMonth = `${year}å¹´${month}æœˆ`;
        
        if (!groupedByYearMonth[yearMonth]) {
          groupedByYearMonth[yearMonth] = [];
        }
        groupedByYearMonth[yearMonth].push(post);
      });

      // æŒ‰æ—¶é—´å€’åºæ’åˆ—
      const sortedGroups = Object.keys(groupedByYearMonth).sort((a, b) => {
        const dateA = new Date(a.replace('å¹´', '-').replace('æœˆ', ''));
        const dateB = new Date(b.replace('å¹´', '-').replace('æœˆ', ''));
        return dateB - dateA;
      });

      let html = filterInfo;
      sortedGroups.forEach(yearMonth => {
        const postsInMonth = groupedByYearMonth[yearMonth];
        html += `<div class="blog-archive-group" style="margin-bottom: 3rem;">
          <h2 class="blog-archive-title" style="font-size: 1.5rem; font-weight: 600; color: #1f2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">${yearMonth}</h2>
          <div class="blog-archive-posts" style="display: grid; gap: 1rem;">
        `;
        
        postsInMonth.forEach(post => {
          const date = formatDate(post.createdAt || post.created_at);
          const category = post.category || post._sourceApiName || '';
          html += `
            <div class="blog-archive-item" style="padding: 1rem; background: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; transition: all 0.2s; position: relative;">
              ${isAdminLoggedIn ? `
                <button class="blog-post-edit-btn" onclick="editPost('${post.id}'); event.stopPropagation();" title="ç¼–è¾‘æ–‡ç« " style="display: ${isAdminLoggedIn ? 'inline-flex' : 'none'}; position: absolute; top: 0.75rem; right: 0.75rem;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
              ` : ''}
              <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                <div style="flex: 1;">
                  <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" style="font-size: 1.125rem; font-weight: 600; color: #1f2937; text-decoration: none; display: block; margin-bottom: 0.5rem; transition: color 0.2s;" 
                     onmouseover="this.style.color='#d97706'" 
                     onmouseout="this.style.color='#1f2937'">
                    ${escapeHtml(post.name || post.title || 'æœªå‘½å')}
                  </a>
                  <div style="display: flex; align-items: center; gap: 1rem; font-size: 0.875rem; color: #6b7280;">
                    <span>${date}</span>
                    ${category ? `<span style="color: #d97706;">#${escapeHtml(category)}</span>` : ''}
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `</div></div>`;
      });

      container.innerHTML = html;
    }

    // æ¸…é™¤ç­›é€‰æ¡ä»¶
    function clearFilters() {
      currentCategory = null;
      currentTag = null;
      currentSearch = null;
      currentPage = 1;
      
      // æ¸…é™¤æœç´¢æ¡†
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.value = '';
      }
      
      // æ›´æ–°åˆ†ç±»å’Œæ ‡ç­¾æ˜¾ç¤º
      loadCategories();
      loadTags();
      
      // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼é‡æ–°åŠ è½½
      if (viewMode === 'archive') {
        loadArchive();
      } else {
        loadPosts(1);
      }
      
      showToast('å·²æ¸…é™¤ç­›é€‰æ¡ä»¶', 'info');
    }

    // åˆ‡æ¢è§†å›¾æ¨¡å¼
    function switchViewMode(mode) {
      viewMode = mode;
      
      if (mode === 'posts') {
        document.getElementById('posts').style.display = 'block';
        document.getElementById('archive').style.display = 'none';
        loadPosts(1);
      } else if (mode === 'archive') {
        document.getElementById('posts').style.display = 'none';
        document.getElementById('archive').style.display = 'block';
        loadArchive();
      }
    }

    // æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨
    function displayPosts(posts) {
      const grid = document.getElementById('postsGrid');
      
      if (!posts || posts.length === 0) {
        grid.innerHTML = '<div class="blog-empty">æš‚æ— æ–‡ç« </div>';
        return;
      }
      
      grid.innerHTML = posts.map((post, index) => {
        const imageUrl = post.image || '';
        const date = formatDate(post.createdAt || post.created_at);
        // categoryå­—æ®µä½œä¸ºæ ‡ç­¾ä½¿ç”¨
        const category = post.category || post._sourceApiName || '';
        const apiName = post._sourceApiName || '';
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹æ®Šç±»åˆ«ï¼Œéœ€è¦å®šåˆ¶æ˜¾ç¤º
        const isExchangeRate = apiName.toLowerCase().includes('exchange') || apiName.toLowerCase().includes('æ±‡ç‡');
        const isTranslation = apiName.toLowerCase().includes('translation') || apiName.toLowerCase().includes('ç¿»è¯‘');
        const isWeather = apiName.toLowerCase().includes('weather') || apiName.toLowerCase().includes('å¤©æ°”');
        
        let excerpt = '';
        let customContent = '';
        
        if (isWeather && post._originalData) {
          // å¤©æ°”è·¯å†µï¼šæ˜¾ç¤ºé¢„è­¦å’Œç®€è¦ä¿¡æ¯
          if (post._originalData.globalAlert && post._originalData.globalAlert.message) {
            const alertLevel = post._originalData.globalAlert.level || 'medium';
            const levelColors = {
              'low': { bg: '#dbeafe', border: '#3b82f6' },
              'medium': { bg: '#fef3c7', border: '#f59e0b' },
              'high': { bg: '#fee2e2', border: '#ef4444' }
            };
            const colors = levelColors[alertLevel] || levelColors['medium'];
            const message = post._originalData.globalAlert.message;
            const shortMessage = message.length > 60 ? message.substring(0, 60) + '...' : message;
            
            customContent = `<div style="padding: 0.75rem; background: ${colors.bg}; border-left: 3px solid ${colors.border}; border-radius: 0.5rem; margin-top: 0.5rem;">
              <div style="font-weight: 600; color: ${colors.border}; margin-bottom: 0.25rem; font-size: 0.875rem;">âš ï¸ å…¨å±€é¢„è­¦</div>
              <div style="color: #374151; font-size: 0.9375rem; line-height: 1.5;">${escapeHtml(shortMessage)}</div>
              ${(post._originalData.attractions && post._originalData.attractions.length > 0) || (post._originalData.traffic && post._originalData.traffic.length > 0) 
                ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">
                    ${post._originalData.attractions && post._originalData.attractions.length > 0 ? `ğŸ“ ${post._originalData.attractions.length} ä¸ªæ™¯ç‚¹` : ''}
                    ${post._originalData.attractions && post._originalData.attractions.length > 0 && post._originalData.traffic && post._originalData.traffic.length > 0 ? ' â€¢ ' : ''}
                    ${post._originalData.traffic && post._originalData.traffic.length > 0 ? `ğŸš¦ ${post._originalData.traffic.length} æ¡è·¯å†µ` : ''}
                  </div>`
                : ''}
            </div>`;
          }
        } else if (isExchangeRate && post._originalData) {
          // æ±‡ç‡è½¬æ¢ï¼šæ˜¾ç¤ºç®€è¦æ±‡ç‡ä¿¡æ¯
          const excludeFields = ['id', 'name', 'title', 'slug', 'excerpt', 'description', 'htmlContent', 'image', 'category', 'tags', 'published', 'views', 'createdAt', 'updatedAt', 'detailApi', 'updateTime'];
          const currencies = Object.keys(post._originalData).filter(k => 
            !excludeFields.includes(k) && 
            post._originalData[k] && 
            typeof post._originalData[k] === 'object' && 
            !Array.isArray(post._originalData[k])
          );
          
          if (currencies.length > 0) {
            const firstCurrency = currencies[0];
            const firstRate = post._originalData[firstCurrency];
            if (firstRate && typeof firstRate === 'object') {
              const firstTarget = Object.keys(firstRate)[0];
              const rateValue = firstRate[firstTarget];
              if (typeof rateValue === 'number') {
                customContent = `<div style="padding: 0.75rem; background: linear-gradient(to right, #10b98115, #05966915); border-radius: 0.5rem; margin-top: 0.5rem;">
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-weight: 600; color: #10b981;">${escapeHtml(firstCurrency)}</span>
                    <span style="color: #6b7280;">â†’</span>
                    <span style="font-weight: 600; color: #059669;">${escapeHtml(firstTarget)}</span>
                    <span style="font-size: 1.25rem; font-weight: bold; color: #10b981;">${rateValue.toFixed(4)}</span>
                  </div>
                  ${currencies.length > 1 ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">å…± ${currencies.length} ç§è´§å¸æ±‡ç‡</div>` : ''}
                </div>`;
              }
            }
          }
        } else if (isTranslation && post._originalData) {
          // ç¿»è¯‘å¡ç‰‡ï¼šæ˜¾ç¤ºä¸­é˜¿å¯¹ç…§
          if (post._originalData.chinese && post._originalData.arabic) {
            customContent = `<div style="padding: 0.75rem; background: linear-gradient(to right, #9333ea15, #7c3aed15); border-radius: 0.5rem; margin-top: 0.5rem;">
              <div style="display: grid; gap: 0.5rem;">
                <div style="font-size: 1rem; color: #374151;">${escapeHtml(post._originalData.chinese)}</div>
                <div style="font-size: 1rem; color: #374151; direction: rtl; text-align: right; font-family: 'Arial', 'Tahoma', sans-serif;">${escapeHtml(post._originalData.arabic)}</div>
              </div>
            </div>`;
          }
        } else {
          excerpt = truncate(post.excerpt || post.description || '', 100);
        }
        
        return `
          <article class="blog-post-card" style="animation-delay: ${index * 0.1}s; position: relative;">
            ${isAdminLoggedIn ? `
              <button class="blog-post-edit-btn" onclick="editPost('${post.id}'); event.stopPropagation();" title="ç¼–è¾‘æ–‡ç« " style="display: ${isAdminLoggedIn ? 'inline-flex' : 'none'};">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            ` : ''}
            <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" class="blog-post-image">
              ${imageUrl ? `<img src="${imageUrl}" alt="${escapeHtml(post.name || post.title || '')}" loading="lazy">` : '<div style="width:100%;height:100%;background:linear-gradient(to bottom right, #f5f5f5, #e5e5e5);"></div>'}
            </a>
            <div style="padding: 0 0.5rem 0.5rem;">
              <div class="blog-post-meta">
                ${category ? `<a href="#" class="blog-post-tag-badge" onclick="filterByTag('${escapeHtml(category)}'); return false;">${escapeHtml(category)}</a>` : ''}
                <span class="blog-post-date">${date}</span>
              </div>
              <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" class="blog-post-title">
                ${escapeHtml(post.name || post.title || 'æœªå‘½å')}
              </a>
              ${customContent || (excerpt ? `<p class="blog-post-excerpt">${escapeHtml(excerpt)}</p>` : '')}
            </div>
          </article>
        `;
      }).join('');
    }

    // æ˜¾ç¤ºåˆ†é¡µ
    function displayPagination() {
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      // ä¸Šä¸€é¡µ
      if (currentPage > 1) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage - 1}); return false;">ä¸Šä¸€é¡µ</a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.5; cursor: not-allowed;">ä¸Šä¸€é¡µ</span>`;
      }
      
      // é¡µç 
      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
          html += `<span class="blog-pagination-btn active">${i}</span>`;
        } else {
          html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${i}); return false;">${i}</a>`;
        }
      }
      
      // ä¸‹ä¸€é¡µ
      if (currentPage < totalPages) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage + 1}); return false;">ä¸‹ä¸€é¡µ</a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.5; cursor: not-allowed;">ä¸‹ä¸€é¡µ</span>`;
      }
      
      pagination.innerHTML = html;
    }

    // åŠ è½½åˆ†ç±»
    async function loadCategories() {
      try {
        const response = await getCategories();
        if (response.success) {
          displayCategories(response.data);
        }
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºåˆ†ç±»
    function displayCategories(categories) {
      const list = document.getElementById('categoriesList');
      
      if (!categories || categories.length === 0) {
        list.innerHTML = '<span style="color: #9ca3af;">æš‚æ— åˆ†ç±»</span>';
        return;
      }
      
      list.innerHTML = categories.map(cat => {
        const count = cat.postCount || 0;
        const isActive = currentCategory === cat.name ? 'active' : '';
        return `<a href="#" class="blog-taxonomy-item ${isActive}" onclick="filterByCategory('${escapeHtml(cat.name)}'); return false;">${escapeHtml(cat.name)} <span style="color: #9ca3af; font-size: 0.8125rem;">(${count})</span></a>`;
      }).join('');
    }

    // åŠ è½½æ ‡ç­¾
    async function loadTags() {
      try {
        const response = await getTags();
        if (response.success) {
          displayTags(response.data);
        }
      } catch (error) {
        console.error('åŠ è½½æ ‡ç­¾å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºæ ‡ç­¾
    function displayTags(tags) {
      const list = document.getElementById('tagsList');
      
      if (!tags || tags.length === 0) {
        list.innerHTML = '<span style="color: #9ca3af; font-size: 0.875rem;">æš‚æ— æ ‡ç­¾</span>';
        return;
      }
      
      list.innerHTML = tags.map(tag => {
        const count = tag.postCount || 0;
        const isActive = currentTag === tag.name ? 'active' : '';
        return `<a href="#" class="blog-taxonomy-item ${isActive}" onclick="filterByTag('${escapeHtml(tag.name)}'); return false;">#${escapeHtml(tag.name)} <span style="opacity: 0.7;">(${count})</span></a>`;
      }).join('');
    }

    // æŒ‰åˆ†ç±»ç­›é€‰
    function filterByCategory(category) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰åˆ†ç±»ï¼Œåˆ™å–æ¶ˆç­›é€‰
      if (currentCategory === category) {
        currentCategory = null;
      } else {
        currentCategory = category;
      }
      currentTag = null;
      currentSearch = null;
      currentPage = 1;
      
      // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
      loadCategories();
      
      // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
      if (viewMode === 'archive') {
        loadArchive();
      } else {
        loadPosts(1);
      }
      
      if (currentCategory) {
        showToast(`ç­›é€‰åˆ†ç±»: ${currentCategory}`, 'info');
      } else {
        showToast('å·²æ¸…é™¤åˆ†ç±»ç­›é€‰', 'info');
      }
    }

    // æŒ‰æ ‡ç­¾ç­›é€‰
    function filterByTag(tag) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰æ ‡ç­¾ï¼Œåˆ™å–æ¶ˆç­›é€‰
      if (currentTag === tag) {
        currentTag = null;
      } else {
        currentTag = tag;
      }
      currentCategory = null;
      currentSearch = null;
      currentPage = 1;
      
      // æ›´æ–°æ ‡ç­¾æ˜¾ç¤º
      loadTags();
      
      // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
      if (viewMode === 'archive') {
        loadArchive();
      } else {
        loadPosts(1);
      }
      
      if (currentTag) {
        showToast(`ç­›é€‰æ ‡ç­¾: ${currentTag}`, 'info');
      } else {
        showToast('å·²æ¸…é™¤æ ‡ç­¾ç­›é€‰', 'info');
      }
    }

    // æœç´¢
    function handleSearchKeyPress(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
        if (query) {
          currentSearch = query;
          currentCategory = null;
          currentTag = null;
          currentPage = 1;
          
          // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
          if (viewMode === 'archive') {
            loadArchive();
          } else {
            loadPosts(1);
          }
          
          showToast(`æœç´¢: ${query}`, 'info');
        } else {
          // æ¸…é™¤æœç´¢
          currentSearch = null;
          currentPage = 1;
          
          // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
          if (viewMode === 'archive') {
            loadArchive();
          } else {
            loadPosts(1);
          }
        }
      }
    }

    // æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
    async function checkAdminAuth() {
      try {
        const response = await fetch('/api/auth/admin/me', {
          credentials: 'include',
          method: 'GET'
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data && data.success && data.admin) {
            isAdminLoggedIn = true;
            // å¦‚æœå·²ç™»å½•ï¼Œæ›´æ–°UIæ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
            updateEditButtons();
            return true;
          }
        }
        isAdminLoggedIn = false;
        return false;
      } catch (error) {
        console.error('æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€å¤±è´¥:', error);
        isAdminLoggedIn = false;
        return false;
      }
    }

    // ç¼–è¾‘æ–‡ç« ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰
    function editPost(postId) {
      if (!isAdminLoggedIn) {
        // å¦‚æœæœªç™»å½•ï¼Œè·³è½¬åˆ°ç®¡ç†ç•Œé¢ç™»å½•
        window.location.href = '/blog-admin.html';
        return;
      }
      
      // åœ¨æ–°çª—å£æ‰“å¼€ç¼–è¾‘é¡µé¢
      const editUrl = `/blog-admin.html?edit=${encodeURIComponent(postId)}`;
      const editWindow = window.open(editUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
      
      if (!editWindow) {
        showToast('æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®', 'error');
        return;
      }
      
      // ç›‘å¬æ–°çª—å£å…³é—­äº‹ä»¶ï¼Œåˆ·æ–°æ–‡ç« åˆ—è¡¨
      const checkClosed = setInterval(() => {
        if (editWindow.closed) {
          clearInterval(checkClosed);
          // åˆ·æ–°æ–‡ç« åˆ—è¡¨ï¼ˆæ ¹æ®å½“å‰è§†å›¾æ¨¡å¼ï¼‰
          if (viewMode === 'archive') {
            loadArchive();
          } else {
            loadPosts(1);
          }
        }
      }, 500);
    }

    // æ›´æ–°ç¼–è¾‘æŒ‰é’®æ˜¾ç¤º
    function updateEditButtons() {
      if (!isAdminLoggedIn) {
        // å¦‚æœæœªç™»å½•ï¼Œéšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®
        document.querySelectorAll('.blog-post-edit-btn').forEach(btn => {
          btn.style.display = 'none';
        });
        return;
      }
      
      // æ›´æ–°æ–‡ç« å¡ç‰‡ä¸­çš„ç¼–è¾‘æŒ‰é’®
      document.querySelectorAll('.blog-post-edit-btn').forEach(btn => {
        btn.style.display = 'inline-flex';
      });
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      initParticles();
      
      // æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
      await checkAdminAuth();
      
      loadPosts(1);
      loadCategories();
      loadTags();
      
      // æµè§ˆæ–‡ç« æŒ‰é’®
      document.querySelector('a[href="#posts"]')?.addEventListener('click', (e) => {
        e.preventDefault();
        switchViewMode('posts');
        document.getElementById('posts').scrollIntoView({ behavior: 'smooth' });
      });

      // æ–‡ç« å½’æ¡£æŒ‰é’®
      document.querySelector('a[href="#archive"]')?.addEventListener('click', (e) => {
        e.preventDefault();
        switchViewMode('archive');
        document.getElementById('archive').scrollIntoView({ behavior: 'smooth' });
      });
    });
  </script>
</body>
</html>
