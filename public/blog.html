<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åšå®¢ - DevBlog</title>
  <link rel="stylesheet" href="/css/blog.css">
  <style>
    /* ç²’å­èƒŒæ™¯æ•ˆæœ */
    .particles-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .particle {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(147, 51, 234, 0.1));
      animation: float 20s infinite;
    }
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
  </style>
</head>
<body class="blog-page">
  <!-- ç²’å­èƒŒæ™¯ -->
  <div class="particles-background" id="particles"></div>

  <!-- å¯¼èˆªæ  -->
  <nav class="blog-nav">
    <div class="blog-nav-content">
      <a href="/blog.html" class="blog-logo">
        <div class="blog-logo-icon">B</div>
        <span>DevBlog.</span>
      </a>
      <div class="blog-nav-actions">
        <div class="blog-search">
          <input 
            type="text" 
            class="blog-search-input" 
            id="searchInput"
            placeholder="æœç´¢æ–‡ç« ..."
            onkeypress="handleSearchKeyPress(event)"
          >
        </div>
        <a href="/blog-admin.html" class="blog-btn blog-btn-secondary" style="font-size: 0.875rem; padding: 0.5rem 1rem;">ç®¡ç†</a>
      </div>
    </div>
  </nav>

  <!-- é¦–é¡µæ ‡é¢˜åŒºåŸŸ -->
  <section class="blog-hero">
    <h1>ç”¨æŠ€æœ¯æ„å»º<span style="background: linear-gradient(to right, #ec4899, #9333ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">æœªæ¥ã€‚</span></h1>
    <p>å…¨æ ˆå¼€å‘è€…çš„æ€è€ƒæ²‰æ·€ã€‚ä¸“æ³¨äº React, Next.js, ä»¥åŠç°ä»£åŒ–çš„ UI è®¾è®¡ã€‚</p>
    <div class="blog-hero-actions">
      <a href="#posts" class="blog-btn blog-btn-primary">æµè§ˆæ–‡ç« </a>
      <a href="#archive" class="blog-btn blog-btn-secondary">æ–‡ç« å½’æ¡£</a>
    </div>
  </section>

  <!-- æ–‡ç« åˆ—è¡¨ -->
  <section id="posts" class="blog-posts-section">
    <div class="blog-posts-grid" id="postsGrid">
      <div class="blog-loading">åŠ è½½ä¸­...</div>
    </div>
    <div class="blog-pagination" id="pagination"></div>
  </section>

  <!-- åˆ†ç±»å’Œæ ‡ç­¾ -->
  <section class="blog-taxonomy-section">
    <div class="blog-taxonomy-grid">
      <div class="blog-taxonomy-card">
        <h2 class="blog-taxonomy-title">åˆ†ç±»</h2>
        <div class="blog-taxonomy-list" id="categoriesList">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
      <div class="blog-taxonomy-card">
        <h2 class="blog-taxonomy-title">æ ‡ç­¾</h2>
        <div class="blog-taxonomy-list" id="tagsList">
          <div class="blog-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>
  </section>

  <!-- é¡µè„š -->
  <footer class="blog-footer">
    <div class="blog-footer-content">
      <div class="blog-footer-text">Â© 2024 DevBlog. All rights reserved.</div>
      <div class="blog-footer-links">
        <a href="/feed.xml" class="blog-footer-link" title="RSS è®¢é˜…">RSS</a>
      </div>
    </div>
  </footer>

  <!-- è„šæœ¬ -->
  <script src="/utils/blog.js"></script>
  <script>
    // å½“å‰é¡µç 
    let currentPage = 1;
    const pageSize = 6;
    let totalPages = 1;
    let currentCategory = null;
    let currentTag = null;
    let currentSearch = null;

    // åˆå§‹åŒ–ç²’å­èƒŒæ™¯
    function initParticles() {
      const container = document.getElementById('particles');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 100 + 50;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.opacity = Math.random() * 0.3 + 0.1;
        container.appendChild(particle);
      }
    }

    // åŠ è½½æ–‡ç« åˆ—è¡¨
    async function loadPosts(page = 1) {
      try {
        const options = {
          page,
          pageSize,
          published: 'true'
        };
        
        if (currentCategory) {
          options.category = currentCategory;
        }
        if (currentTag) {
          options.tag = currentTag;
        }
        if (currentSearch) {
          options.search = currentSearch;
        }
        
        const response = await getPosts(options);
        
        if (response.success) {
          displayPosts(response.data);
          currentPage = response.pagination.currentPage;
          totalPages = response.pagination.totalPages;
          displayPagination();
        } else {
          showToast('åŠ è½½æ–‡ç« å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
        showToast('åŠ è½½æ–‡ç« å¤±è´¥: ' + error.message, 'error');
        document.getElementById('postsGrid').innerHTML = '<div class="blog-empty">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
      }
    }

    // æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨
    function displayPosts(posts) {
      const grid = document.getElementById('postsGrid');
      
      if (!posts || posts.length === 0) {
        grid.innerHTML = '<div class="blog-empty">æš‚æ— æ–‡ç« </div>';
        return;
      }
      
      grid.innerHTML = posts.map((post, index) => {
        const imageUrl = post.image || '';
        const date = formatDate(post.createdAt || post.created_at);
        // categoryå­—æ®µä½œä¸ºæ ‡ç­¾ä½¿ç”¨
        const category = post.category || post._sourceApiName || '';
        const apiName = post._sourceApiName || '';
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹æ®Šç±»åˆ«ï¼Œéœ€è¦å®šåˆ¶æ˜¾ç¤º
        const isExchangeRate = apiName.toLowerCase().includes('exchange') || apiName.toLowerCase().includes('æ±‡ç‡');
        const isTranslation = apiName.toLowerCase().includes('translation') || apiName.toLowerCase().includes('ç¿»è¯‘');
        const isWeather = apiName.toLowerCase().includes('weather') || apiName.toLowerCase().includes('å¤©æ°”');
        
        let excerpt = '';
        let customContent = '';
        
        if (isWeather && post._originalData) {
          // å¤©æ°”è·¯å†µï¼šæ˜¾ç¤ºé¢„è­¦å’Œç®€è¦ä¿¡æ¯
          if (post._originalData.globalAlert && post._originalData.globalAlert.message) {
            const alertLevel = post._originalData.globalAlert.level || 'medium';
            const levelColors = {
              'low': { bg: '#dbeafe', border: '#3b82f6' },
              'medium': { bg: '#fef3c7', border: '#f59e0b' },
              'high': { bg: '#fee2e2', border: '#ef4444' }
            };
            const colors = levelColors[alertLevel] || levelColors['medium'];
            const message = post._originalData.globalAlert.message;
            const shortMessage = message.length > 60 ? message.substring(0, 60) + '...' : message;
            
            customContent = `<div style="padding: 0.75rem; background: ${colors.bg}; border-left: 3px solid ${colors.border}; border-radius: 0.5rem; margin-top: 0.5rem;">
              <div style="font-weight: 600; color: ${colors.border}; margin-bottom: 0.25rem; font-size: 0.875rem;">âš ï¸ å…¨å±€é¢„è­¦</div>
              <div style="color: #374151; font-size: 0.9375rem; line-height: 1.5;">${escapeHtml(shortMessage)}</div>
              ${(post._originalData.attractions && post._originalData.attractions.length > 0) || (post._originalData.traffic && post._originalData.traffic.length > 0) 
                ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">
                    ${post._originalData.attractions && post._originalData.attractions.length > 0 ? `ğŸ“ ${post._originalData.attractions.length} ä¸ªæ™¯ç‚¹` : ''}
                    ${post._originalData.attractions && post._originalData.attractions.length > 0 && post._originalData.traffic && post._originalData.traffic.length > 0 ? ' â€¢ ' : ''}
                    ${post._originalData.traffic && post._originalData.traffic.length > 0 ? `ğŸš¦ ${post._originalData.traffic.length} æ¡è·¯å†µ` : ''}
                  </div>`
                : ''}
            </div>`;
          }
        } else if (isExchangeRate && post._originalData) {
          // æ±‡ç‡è½¬æ¢ï¼šæ˜¾ç¤ºç®€è¦æ±‡ç‡ä¿¡æ¯
          const excludeFields = ['id', 'name', 'title', 'slug', 'excerpt', 'description', 'htmlContent', 'image', 'category', 'tags', 'published', 'views', 'createdAt', 'updatedAt', 'detailApi', 'updateTime'];
          const currencies = Object.keys(post._originalData).filter(k => 
            !excludeFields.includes(k) && 
            post._originalData[k] && 
            typeof post._originalData[k] === 'object' && 
            !Array.isArray(post._originalData[k])
          );
          
          if (currencies.length > 0) {
            const firstCurrency = currencies[0];
            const firstRate = post._originalData[firstCurrency];
            if (firstRate && typeof firstRate === 'object') {
              const firstTarget = Object.keys(firstRate)[0];
              const rateValue = firstRate[firstTarget];
              if (typeof rateValue === 'number') {
                customContent = `<div style="padding: 0.75rem; background: linear-gradient(to right, #10b98115, #05966915); border-radius: 0.5rem; margin-top: 0.5rem;">
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-weight: 600; color: #10b981;">${escapeHtml(firstCurrency)}</span>
                    <span style="color: #6b7280;">â†’</span>
                    <span style="font-weight: 600; color: #059669;">${escapeHtml(firstTarget)}</span>
                    <span style="font-size: 1.25rem; font-weight: bold; color: #10b981;">${rateValue.toFixed(4)}</span>
                  </div>
                  ${currencies.length > 1 ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">å…± ${currencies.length} ç§è´§å¸æ±‡ç‡</div>` : ''}
                </div>`;
              }
            }
          }
        } else if (isTranslation && post._originalData) {
          // ç¿»è¯‘å¡ç‰‡ï¼šæ˜¾ç¤ºä¸­é˜¿å¯¹ç…§
          if (post._originalData.chinese && post._originalData.arabic) {
            customContent = `<div style="padding: 0.75rem; background: linear-gradient(to right, #9333ea15, #7c3aed15); border-radius: 0.5rem; margin-top: 0.5rem;">
              <div style="display: grid; gap: 0.5rem;">
                <div style="font-size: 1rem; color: #374151;">${escapeHtml(post._originalData.chinese)}</div>
                <div style="font-size: 1rem; color: #374151; direction: rtl; text-align: right; font-family: 'Arial', 'Tahoma', sans-serif;">${escapeHtml(post._originalData.arabic)}</div>
              </div>
            </div>`;
          }
        } else {
          excerpt = truncate(post.excerpt || post.description || '', 100);
        }
        
        return `
          <article class="blog-post-card" style="animation-delay: ${index * 0.1}s">
            <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" class="blog-post-image">
              ${imageUrl ? `<img src="${imageUrl}" alt="${escapeHtml(post.name || post.title || '')}" loading="lazy">` : '<div style="width:100%;height:100%;background:linear-gradient(to bottom right, #f5f5f5, #e5e5e5);"></div>'}
            </a>
            <div style="padding: 0 0.5rem 0.5rem;">
              <div class="blog-post-meta">
                ${apiName ? `<a href="#" class="blog-post-category" onclick="filterByCategory('${escapeHtml(apiName)}'); return false;">${escapeHtml(apiName)}</a>` : ''}
                ${category ? `<a href="#" class="blog-post-tag" onclick="filterByTag('${escapeHtml(category)}'); return false;">#${escapeHtml(category)}</a>` : ''}
                <span class="blog-post-date">${date}</span>
              </div>
              <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" class="blog-post-title">
                ${escapeHtml(post.name || post.title || 'æœªå‘½å')}
              </a>
              ${customContent || (excerpt ? `<p class="blog-post-excerpt">${escapeHtml(excerpt)}</p>` : '')}
            </div>
          </article>
        `;
      }).join('');
    }

    // æ˜¾ç¤ºåˆ†é¡µ
    function displayPagination() {
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      // ä¸Šä¸€é¡µ
      if (currentPage > 1) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage - 1}); return false;">ä¸Šä¸€é¡µ</a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.5; cursor: not-allowed;">ä¸Šä¸€é¡µ</span>`;
      }
      
      // é¡µç 
      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
          html += `<span class="blog-pagination-btn active">${i}</span>`;
        } else {
          html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${i}); return false;">${i}</a>`;
        }
      }
      
      // ä¸‹ä¸€é¡µ
      if (currentPage < totalPages) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage + 1}); return false;">ä¸‹ä¸€é¡µ</a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.5; cursor: not-allowed;">ä¸‹ä¸€é¡µ</span>`;
      }
      
      pagination.innerHTML = html;
    }

    // åŠ è½½åˆ†ç±»
    async function loadCategories() {
      try {
        const response = await getCategories();
        if (response.success) {
          displayCategories(response.data);
        }
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºåˆ†ç±»
    function displayCategories(categories) {
      const list = document.getElementById('categoriesList');
      
      if (!categories || categories.length === 0) {
        list.innerHTML = '<span style="color: #9ca3af;">æš‚æ— åˆ†ç±»</span>';
        return;
      }
      
      list.innerHTML = categories.map(cat => {
        const count = cat.postCount || 0;
        return `<a href="#" class="blog-taxonomy-item" onclick="filterByCategory('${escapeHtml(cat.name)}'); return false;">${escapeHtml(cat.name)} (${count})</a>`;
      }).join('');
    }

    // åŠ è½½æ ‡ç­¾
    async function loadTags() {
      try {
        const response = await getTags();
        if (response.success) {
          displayTags(response.data);
        }
      } catch (error) {
        console.error('åŠ è½½æ ‡ç­¾å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºæ ‡ç­¾
    function displayTags(tags) {
      const list = document.getElementById('tagsList');
      
      if (!tags || tags.length === 0) {
        list.innerHTML = '<span style="color: #9ca3af;">æš‚æ— æ ‡ç­¾</span>';
        return;
      }
      
      list.innerHTML = tags.map(tag => {
        const count = tag.postCount || 0;
        return `<a href="#" class="blog-taxonomy-item" onclick="filterByTag('${escapeHtml(tag.name)}'); return false;">#${escapeHtml(tag.name)} (${count})</a>`;
      }).join('');
    }

    // æŒ‰åˆ†ç±»ç­›é€‰
    function filterByCategory(category) {
      currentCategory = category;
      currentTag = null;
      currentSearch = null;
      currentPage = 1;
      loadPosts(1);
      showToast(`ç­›é€‰åˆ†ç±»: ${category}`, 'info');
    }

    // æŒ‰æ ‡ç­¾ç­›é€‰
    function filterByTag(tag) {
      currentTag = tag;
      currentCategory = null;
      currentSearch = null;
      currentPage = 1;
      loadPosts(1);
      showToast(`ç­›é€‰æ ‡ç­¾: ${tag}`, 'info');
    }

    // æœç´¢
    function handleSearchKeyPress(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
        if (query) {
          currentSearch = query;
          currentCategory = null;
          currentTag = null;
          currentPage = 1;
          loadPosts(1);
          showToast(`æœç´¢: ${query}`, 'info');
        } else {
          // æ¸…é™¤æœç´¢
          currentSearch = null;
          currentPage = 1;
          loadPosts(1);
        }
      }
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      initParticles();
      loadPosts(1);
      loadCategories();
      loadTags();
      
      // æ»šåŠ¨åˆ°æ–‡ç« åŒºåŸŸ
      document.querySelector('a[href="#posts"]')?.addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('posts').scrollIntoView({ behavior: 'smooth' });
      });
    });
  </script>
</body>
</html>
