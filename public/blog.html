<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>åšå®¢ - DevBlog</title>
  <link rel="stylesheet" href="/css/blog.css">
  <link rel="stylesheet" href="/css/blog-unified.css">
  <style>
    /* iOS Safari ä¿®å¤ - å…¨å±€é˜²æ­¢æº¢å‡ºï¼ˆä¼˜åŒ–æ€§èƒ½ï¼šå‡å°‘ !important ä½¿ç”¨ï¼‰ */
    html, body {
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }
    
    /* åªåœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ !important è¦†ç›– */
    @media (max-width: 768px) {
      html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
      }
    }
    
    /* PINè¾“å…¥æ¡†åŠ¨ç”» */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .blog-pin-input:focus {
      border-color: #d97706 !important;
      outline: none;
    }
    
    .blog-pin-input.filled {
      border-color: #10b981 !important;
      background-color: #f0fdf4 !important;
    }
    
    .blog-pin-input.error {
      border-color: #ef4444 !important;
      background-color: #fef2f2 !important;
    }
    
    /* åŸƒåŠä¸»é¢˜èƒŒæ™¯ */
    .particles-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
      background: linear-gradient(180deg, #fef9f3 0%, #fff 50%, #f9fafb 100%);
    }
    
    /* é‡‘å­—å¡”è£…é¥° */
    .particles-background::before {
      content: '';
      position: absolute;
      top: 10%;
      right: 5%;
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.03) 0%, rgba(217, 119, 6, 0.01) 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      opacity: 0.5;
      animation: float 30s infinite ease-in-out;
    }
    
    .particles-background::after {
      content: '';
      position: absolute;
      bottom: 15%;
      left: 8%;
      width: 150px;
      height: 150px;
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.02) 0%, rgba(217, 119, 6, 0.005) 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      opacity: 0.4;
      animation: float 25s infinite ease-in-out reverse;
    }
    
    .particle {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(217, 119, 6, 0.08) 0%, rgba(217, 119, 6, 0.02) 100%);
      animation: float 20s infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
    
    /* å¯çˆ±çš„åŠ è½½åŠ¨ç”» */
    @keyframes bounce {
      0%, 100% {
        transform: translateY(0) scale(1);
      }
      50% {
        transform: translateY(-15px) scale(1.1);
      }
    }
    
    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }
    
    @keyframes rotateEmoji {
      0% {
        transform: rotate(0deg) scale(1);
      }
      25% {
        transform: rotate(-10deg) scale(1.05);
      }
      50% {
        transform: rotate(0deg) scale(1.1);
      }
      75% {
        transform: rotate(10deg) scale(1.05);
      }
      100% {
        transform: rotate(0deg) scale(1);
      }
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body class="blog-page">
  <!-- ç²’å­èƒŒæ™¯ -->
  <div class="particles-background" id="particles"></div>

  <!-- å¯¼èˆªæ  -->
  <nav class="blog-nav" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #e5e7eb;">
    <div class="blog-nav-content" style="max-width: 1600px; margin: 0 auto; padding: 0 1rem;">
      <a href="/blog.html" class="blog-logo" style="font-size: 1.25rem; font-weight: 700;">
        <div class="blog-logo-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor" opacity="0.9"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>PRO<span style="background: linear-gradient(to right, #d97706, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">EG</span></span>
      </a>
      <div class="blog-nav-actions" style="display: flex; align-items: center; gap: 0.75rem;">
        <div class="blog-search" style="max-width: 300px;">
          <input 
            type="text" 
            class="blog-search-input" 
            id="searchInput"
            placeholder="æœç´¢æ–‡ç« ..."
            onkeypress="handleSearchKeyPress(event)"
            style="width: 100%;"
          >
        </div>
        <!-- ç”¨æˆ·ç™»å½•çŠ¶æ€æ˜¾ç¤º -->
        <div id="userLoginStatus" style="display: none; align-items: center; gap: 0.5rem;">
          <span id="userNameDisplay" style="font-size: 0.875rem; color: #374151;"></span>
          <button id="myPostsFilterBtn" onclick="toggleMyPostsFilter()" class="blog-btn blog-btn-secondary blog-btn-sm" style="display: none;" title="åªæ˜¾ç¤ºæˆ‘çš„æ–‡ç« ">
            <svg id="myPostsFilterIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem; vertical-align: middle;">
              <path d="M9 12l2 2 4-4"></path>
              <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
              <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
              <path d="M12 3c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z"></path>
              <path d="M12 21c0-1 1-2 2-2s2 1 2 2-1 2-2 2-2-1-2-2z"></path>
            </svg>
            <span id="myPostsFilterText">æˆ‘çš„æ–‡ç« </span>
          </button>
          <button id="newPostBtn" onclick="newPost()" class="blog-btn blog-btn-primary blog-btn-sm" style="display: none;" title="æ–°å»ºæ–‡ç« ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem; vertical-align: middle;">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
            æ–°å»ºæ–‡ç« 
          </button>
          <button onclick="blogLogout()" class="blog-btn blog-btn-secondary blog-btn-sm">ç™»å‡º</button>
        </div>
        <!-- ç™»å½•æŒ‰é’® -->
        <button id="blogLoginBtn" onclick="showBlogLoginModal()" class="blog-btn blog-btn-primary blog-btn-sm">ç™»å½•</button>
        <a href="/blog-admin.html" class="blog-btn blog-btn-secondary blog-btn-sm">ç®¡ç†</a>
      </div>
    </div>
  </nav>

  <!-- ç™»å½•æ¨¡æ€æ¡† -->
  <div id="blogLoginModal" class="blog-modal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;" onclick="closeBlogLoginModal(event)">
    <div style="background: white; border-radius: 0.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); max-width: 28rem; width: 100%; margin: 1rem; padding: 2rem; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation()">
      <div style="text-align: center; margin-bottom: 1.5rem;">
        <h2 style="font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">ç™»å½•</h2>
        <p style="color: #6b7280;">è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ã€å§“åå’ŒPINç </p>
      </div>
      
      <form id="blogLoginForm" onsubmit="handleBlogLogin(event)" style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div>
          <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">å§“å <span style="color: #ef4444;">*</span></label>
          <input type="text" id="blogLoginName" required
                 style="width: 100%; padding: 0.75rem 1rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem; transition: all 0.2s; box-sizing: border-box;"
                 placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
                 onfocus="this.style.borderColor='#d97706'; this.style.outline='none';"
                 onblur="this.style.borderColor='#d1d5db';">
          <p id="blogLoginNameError" style="display: none; margin-top: 0.25rem; font-size: 0.75rem; color: #ef4444;"></p>
        </div>
        <div>
          <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">æ‰‹æœºå· <span style="color: #ef4444;">*</span></label>
          <input type="tel" id="blogLoginPhone" required maxlength="11" inputmode="numeric" pattern="^0\d{10}$"
                 style="width: 100%; padding: 0.75rem 1rem; border: 2px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem; transition: all 0.2s; box-sizing: border-box;"
                 placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ï¼ˆä»¥0å¼€å¤´ï¼‰"
                 onfocus="this.style.borderColor='#d97706'; this.style.outline='none';"
                 onblur="this.style.borderColor='#d1d5db';">
          <p style="margin-top: 0.25rem; font-size: 0.75rem; color: #6b7280;">æ ¼å¼ï¼š11ä½æ•°å­—ï¼Œä»¥0å¼€å¤´ï¼ˆå¦‚ï¼š01234567890ï¼‰</p>
          <p id="blogLoginPhoneError" style="display: none; margin-top: 0.25rem; font-size: 0.75rem; color: #ef4444;"></p>
        </div>
        <!-- PINè¾“å…¥åŒºåŸŸ -->
        <div id="blogPinSection" style="display: none;">
          <label id="blogPinLabel" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">PINç  <span style="color: #ef4444;">*</span></label>
          <div style="display: flex; justify-content: center; gap: 0.75rem; margin-bottom: 0.5rem;">
            <input type="password" id="blogPin1" maxlength="1" inputmode="numeric" pattern="[0-9]"
                   class="blog-pin-input"
                   style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
            <input type="password" id="blogPin2" maxlength="1" inputmode="numeric" pattern="[0-9]"
                   class="blog-pin-input"
                   style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
            <input type="password" id="blogPin3" maxlength="1" inputmode="numeric" pattern="[0-9]"
                   class="blog-pin-input"
                   style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
            <input type="password" id="blogPin4" maxlength="1" inputmode="numeric" pattern="[0-9]"
                   class="blog-pin-input"
                   style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
          </div>
          <div id="blogPinConfirmSection" style="display: none; margin-top: 1rem;">
            <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">ç¡®è®¤PINç  <span style="color: #ef4444;">*</span></label>
            <div style="display: flex; justify-content: center; gap: 0.75rem;">
              <input type="password" id="blogPinConfirm1" maxlength="1" inputmode="numeric" pattern="[0-9]"
                     class="blog-pin-input"
                     style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
              <input type="password" id="blogPinConfirm2" maxlength="1" inputmode="numeric" pattern="[0-9]"
                     class="blog-pin-input"
                     style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
              <input type="password" id="blogPinConfirm3" maxlength="1" inputmode="numeric" pattern="[0-9]"
                     class="blog-pin-input"
                     style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
              <input type="password" id="blogPinConfirm4" maxlength="1" inputmode="numeric" pattern="[0-9]"
                     class="blog-pin-input"
                     style="width: 3.5rem; height: 3.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; border: 2px solid #d1d5db; border-radius: 0.5rem; transition: all 0.2s; box-sizing: border-box;">
            </div>
            <p id="blogPinMismatchError" style="display: none; margin-top: 0.5rem; font-size: 0.75rem; color: #ef4444; text-align: center;">PINç ä¸åŒ¹é…ï¼Œè¯·é‡æ–°è¾“å…¥</p>
          </div>
          <p style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280;">è¯·è¾“å…¥4ä½æ•°å­—PINç </p>
        </div>
        <div style="display: flex; gap: 0.75rem;">
          <button type="submit" id="blogLoginSubmitBtn"
                  style="flex: 1; background: linear-gradient(to right, #d97706, #f59e0b); color: white; font-weight: 600; padding: 0.75rem; border-radius: 0.5rem; transition: all 0.3s; border: none; cursor: pointer; font-size: 0.875rem;">
            ç™»å½•
          </button>
          <button type="button" onclick="closeBlogLoginModal(event)"
                  style="flex: 1; background: #e5e7eb; color: #374151; font-weight: 600; padding: 0.75rem; border-radius: 0.5rem; transition: all 0.2s; border: none; cursor: pointer; font-size: 0.875rem;">
            å–æ¶ˆ
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - ç´§å‡‘å¸ƒå±€ï¼Œä¾§è¾¹æ é è¾¹ï¼Œå®½å±è‡ªé€‚åº” -->
  <div class="blog-main-layout">
    <!-- å·¦ä¾§è¾¹æ ï¼šçƒ­é—¨æ–‡ç« å’Œå…¬å‘Š -->
    <aside class="blog-sidebar blog-sidebar-left">
      <!-- çƒ­é—¨æ–‡ç«  -->
      <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #374151; margin: 0 0 0.5rem 0; text-transform: uppercase; letter-spacing: 0.05em;">ğŸ”¥ çƒ­é—¨æ–‡ç« </h3>
        <div id="hotPostsList" style="display: flex; flex-direction: column; gap: 0.5rem; width: 100%;">
          <div class="blog-loading" style="font-size: 0.8125rem;">åŠ è½½ä¸­...</div>
        </div>
      </div>
      
      <!-- å…¬å‘Šæ  -->
      <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #fbbf24; border-radius: 0.375rem; padding: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #92400e; margin: 0 0 0.375rem 0; display: flex; align-items: center; gap: 0.375rem;">
          <span>ğŸ“¢</span> å…¬å‘Š
        </h3>
        <p style="font-size: 0.75rem; color: #78350f; margin: 0; line-height: 1.4;">æ¬¢è¿æ¥åˆ°ç”Ÿäº§ç¯å¢ƒåšå®¢ç«¯ï¼Œè¿™é‡Œæ±‡é›†åŸƒæ—…å°å·¥å…·å¾®ä¿¡å°ç¨‹åºæ‰€æœ‰å†…å®¹ã€‚</p>
      </div>
    </aside>

    <!-- ä¸­é—´å†…å®¹åŒºåŸŸï¼šæ–‡ç« å¡ç‰‡ï¼ˆè‡ªé€‚åº”ç½‘æ ¼ï¼Œç´§å‡‘å¸ƒå±€ï¼‰ -->
    <main class="blog-content">
      <!-- æ–‡ç« åˆ—è¡¨ -->
      <section id="posts" class="blog-posts-section" style="width: 100%; overflow: hidden;">
        <!-- å¯çˆ±çš„åŠ è½½åŠ¨ç”» -->
        <div id="postsLoadingAnimation" style="display: none; padding: 3rem 2rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-bottom: 1rem;">
          <div style="display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">
            <!-- å¯çˆ±çš„è¡¨æƒ…ç¬¦å·åŠ¨ç”» -->
            <div id="postsLoadingEmoji" style="font-size: 4rem; animation: bounce 1s ease-in-out infinite; filter: drop-shadow(0 4px 8px rgba(217, 119, 6, 0.2));">ğŸ“šâœ¨</div>
            
            <!-- æœ‰è¶£çš„åŠ è½½æç¤ºæ–‡å­— -->
            <div id="postsLoadingText" style="font-size: 1.125rem; color: #6b7280; font-weight: 500; text-align: center; min-height: 1.75rem;">
              æ­£åœ¨åŠ è½½æ–‡ç« ...
            </div>
            
            <!-- è¿›åº¦æ¡ -->
            <div style="width: 100%; max-width: 500px;">
              <div style="height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);">
                <div id="postsLoadingProgressBar" style="height: 100%; background: linear-gradient(90deg, #d97706, #f59e0b, #fbbf24); width: 0%; transition: width 0.3s ease; border-radius: 10px; box-shadow: 0 0 10px rgba(217, 119, 6, 0.4); position: relative; overflow: hidden;">
                  <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: shimmer 1.5s infinite;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="blog-posts-list" id="postsGrid" style="display: flex; flex-direction: column; gap: 0; width: 100%; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; overflow: hidden;">
          <div class="blog-loading" style="padding: 2rem; text-align: center;">åŠ è½½ä¸­...</div>
        </div>
        <div class="blog-pagination" id="pagination" style="margin-top: 1.5rem; margin-bottom: 1rem; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 0.5rem; width: 100%;"></div>
      </section>

    </main>
    
    <!-- å³ä¾§è¾¹æ ï¼šåˆ†ç±» -->
    <aside class="blog-sidebar blog-sidebar-right">
      <div class="blog-taxonomy-card" style="background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
        <h2 class="blog-taxonomy-title" style="font-size: 0.8125rem; font-weight: 600; color: #374151; margin: 0 0 0.5rem 0; text-transform: uppercase; letter-spacing: 0.05em;">åˆ†ç±»</h2>
        <div class="blog-taxonomy-list" id="categoriesList" style="display: flex; flex-direction: column; gap: 0.375rem; width: 100%;">
          <div class="blog-loading" style="font-size: 0.8125rem;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </aside>
  </div>
  
  <!-- å“åº”å¼æ ·å¼ -->
  <style>
    /* è®ºå›é£æ ¼åˆ—è¡¨æ ·å¼ */
    .blog-posts-list {
      display: flex;
      flex-direction: column;
      gap: 0;
      width: 100%;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      overflow: hidden;
    }
    
    .blog-post-item {
      border-bottom: 1px solid #f3f4f6;
    }
    
    .blog-post-item:last-child {
      border-bottom: none;
    }
    
    .blog-post-item:hover {
      background: #f9fafb;
    }
    
    /* ç”µè„‘ç«¯ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®ä¸è¦†ç›–å†…å®¹ */
    @media (min-width: 769px) {
      .blog-post-item .blog-post-actions {
        position: absolute !important;
        right: 0.75rem !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        z-index: 10 !important;
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 0.5rem !important;
      }
      
      .blog-post-item .blog-post-actions .blog-post-edit-btn,
      .blog-post-item .blog-post-actions .blog-post-delete-btn {
        position: static !important;
        width: auto !important;
        height: auto !important;
      }
      
      /* ç¡®ä¿ä¸­é—´å†…å®¹åŒºåŸŸä¸è¢«æ“ä½œæŒ‰é’®é®æŒ¡ï¼ˆåªåœ¨æœ‰æ“ä½œæŒ‰é’®æ—¶ï¼‰ */
      .blog-post-item:has(.blog-post-actions) > div:nth-child(2) {
        padding-right: 10rem !important;
        box-sizing: border-box !important;
      }
    }
    
    /* å…¼å®¹æ—§çš„å¡ç‰‡æ ·å¼ */
    .blog-post-card {
      transition: all 0.2s ease;
    }
    
    /* ä¾§è¾¹æ åˆ—è¡¨é¡¹å¯¹é½ä¼˜åŒ– */
    .blog-taxonomy-list,
    #hotPostsList {
      width: 100%;
      box-sizing: border-box;
    }
    
    .blog-taxonomy-list a {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      width: 100% !important;
      box-sizing: border-box !important;
      text-align: left !important;
    }
    
    .blog-taxonomy-list a > span:first-child {
      flex: 1;
      min-width: 0;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .blog-taxonomy-list a > span:last-child {
      flex-shrink: 0;
      text-align: right;
      margin-left: 0.5rem;
    }
    
    #hotPostsList a {
      display: flex !important;
      align-items: start !important;
      width: 100% !important;
      box-sizing: border-box !important;
    }
    
    #hotPostsList a > span:first-child {
      flex-shrink: 0;
      text-align: center;
    }
    
    #hotPostsList a > div {
      flex: 1;
      min-width: 0;
      text-align: left;
    }
    
    #hotPostsList a > div > div:first-child {
      text-align: left !important;
    }
    
    #hotPostsList a > div > div:last-child {
      text-align: left !important;
    }
    
    /* åˆ†é¡µæŒ‰é’®æ ·å¼ä¼˜åŒ– */
    .blog-pagination-btn {
      min-width: 36px;
      height: 36px;
      padding: 0 0.75rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      border-radius: 0.375rem;
      text-decoration: none;
      color: #374151;
      background: white;
      border: 1px solid #e5e7eb;
      transition: all 0.2s;
    }
    
    .blog-pagination-btn:hover:not(.active):not([style*="opacity"]) {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #d97706;
    }
    
    .blog-pagination-btn.active {
      background: #d97706;
      color: white;
      border-color: #d97706;
      font-weight: 600;
    }
    
    /* è®ºå›é£æ ¼åˆ—è¡¨å¸ƒå±€ */
    #postsGrid.blog-posts-list,
    .blog-posts-list#postsGrid,
    section#posts .blog-posts-list#postsGrid,
    .blog-content .blog-posts-list#postsGrid,
    main.blog-content .blog-posts-list#postsGrid {
      display: flex !important;
      flex-direction: column !important;
      gap: 0 !important;
      width: 100% !important;
      box-sizing: border-box !important;
      max-width: 100% !important;
    }
    
    /* å…¼å®¹æ—§çš„ç½‘æ ¼å¸ƒå±€ï¼ˆå·²åºŸå¼ƒï¼‰ */
    #postsGrid.blog-posts-grid,
    .blog-posts-grid#postsGrid {
      display: flex !important;
      flex-direction: column !important;
      gap: 0 !important;
    }
    
    /* ä¸»å¸ƒå±€å®¹å™¨ - ä½¿ç”¨gridå¸ƒå±€ï¼Œç¡®ä¿å±…ä¸­ï¼Œè¦†ç›–CSSæ–‡ä»¶ä¸­çš„flexå¸ƒå±€ */
    .blog-main-layout {
      display: grid !important;
      grid-template-columns: 240px 1fr 240px !important;
      gap: 1rem !important;
      max-width: 1600px !important;
      margin: 0 auto !important;
      padding: 1rem 0.75rem !important;
      width: 100% !important;
      box-sizing: border-box !important;
      position: relative !important;
      z-index: 10 !important;
    }
    
    /* ç¡®ä¿ä¸­é—´å†…å®¹åŒºåŸŸæœ‰è¶³å¤Ÿå®½åº¦ï¼Œç§»é™¤max-widthé™åˆ¶ */
    .blog-content {
      min-width: 0 !important;
      width: 100% !important;
      max-width: none !important;
      overflow: hidden !important;
      flex: none !important;
      order: 0 !important;
    }
    
    /* ä¾§è¾¹æ æ ·å¼é‡ç½®ï¼Œç¡®ä¿åœ¨gridä¸­æ­£ç¡®æ˜¾ç¤º */
    .blog-sidebar {
      width: 100% !important;
      flex-shrink: 0 !important;
      position: sticky !important;
      top: 0.5rem !important;
      align-self: start !important;
      height: fit-content !important;
      max-height: none !important;
      overflow-y: visible !important;
    }
    
    .blog-sidebar-left {
      order: 0 !important;
      padding-left: 0.5rem !important;
    }
    
    .blog-sidebar-right {
      padding-right: 0.5rem !important;
    }
    
    .blog-posts-section {
      width: 100% !important;
      overflow: hidden !important;
    }
    
    /* å¯¼èˆªæ å®½å±é€‚é… */
    @media (min-width: 1921px) {
      .blog-nav-content {
        max-width: 1800px !important;
      }
    }
    
    @media (max-width: 1920px) and (min-width: 1601px) {
      .blog-nav-content {
        max-width: 1600px !important;
      }
    }
    
    @media (max-width: 1600px) and (min-width: 1400px) {
      .blog-nav-content {
        max-width: 1400px !important;
      }
    }
    
    /* è¶…å®½å±é€‚é…ï¼ˆ>1920pxï¼‰ï¼šå¢åŠ æœ€å¤§å®½åº¦ï¼Œå……åˆ†åˆ©ç”¨ç©ºé—´ */
    @media (min-width: 1921px) {
      .blog-main-layout {
        max-width: 1800px !important;
        grid-template-columns: 280px 1fr 280px !important;
        gap: 1.5rem !important;
      }
    }
    
    /* å®½å±é€‚é…ï¼ˆ1600px-1920pxï¼‰ï¼šé€‚åº¦å¢åŠ å®½åº¦ */
    @media (max-width: 1920px) and (min-width: 1601px) {
      .blog-main-layout {
        max-width: 1600px !important;
        grid-template-columns: 260px 1fr 260px !important;
        gap: 1.25rem !important;
      }
    }
    
    /* ä¸­ç­‰å±å¹•ï¼ˆ1400px-1600pxï¼‰ */
    @media (max-width: 1600px) and (min-width: 1400px) {
      .blog-main-layout {
        max-width: 1400px !important;
        grid-template-columns: 220px 1fr 220px !important;
      }
    }
    
    /* å¹³æ¿é€‚é…ï¼ˆ1200px-1400pxï¼‰ */
    @media (max-width: 1400px) and (min-width: 1200px) {
      .blog-main-layout {
        grid-template-columns: 200px 1fr 200px !important;
        gap: 0.75rem !important;
      }
      .blog-sidebar-left,
      .blog-sidebar-right {
        width: 100% !important;
        max-width: 100% !important;
      }
      .blog-sidebar-left > div,
      .blog-sidebar-right > div {
        width: 100% !important;
        max-width: 100% !important;
      }
    }
    
    /* å°å¹³æ¿ï¼ˆ1024px-1200pxï¼‰ */
    @media (max-width: 1200px) and (min-width: 1024px) {
      .blog-main-layout {
        grid-template-columns: 180px 1fr 180px !important;
        gap: 0.75rem !important;
      }
      .blog-sidebar-left,
      .blog-sidebar-right {
        width: 100% !important;
        max-width: 100% !important;
      }
      .blog-sidebar-left > div,
      .blog-sidebar-right > div {
        width: 100% !important;
        max-width: 100% !important;
      }
    }
    
    /* å¹³æ¿ï¼ˆ768px-1024pxï¼‰ï¼šéšè—å³ä¾§è¾¹æ  */
    @media (max-width: 1024px) and (min-width: 768px) {
      .blog-main-layout {
        grid-template-columns: 180px 1fr !important;
        gap: 0.75rem !important;
      }
      .blog-sidebar-right {
        display: none !important;
      }
      .blog-sidebar-left {
        width: 100% !important;
        max-width: 100% !important;
      }
      .blog-sidebar-left > div {
        width: 100% !important;
        max-width: 100% !important;
      }
    }
    
    /* æ‰‹æœºç«¯é€‚é…ï¼ˆ<768pxï¼‰ */
    @media (max-width: 768px) {
      /* ç§»é™¤å¯¼èˆªæ å›ºå®šå®šä½ï¼Œè®©å®ƒå¯ä»¥æ»šåŠ¨ */
      .blog-nav {
        position: static !important;
        z-index: auto !important;
      }
      
      /* åšå®¢ä¸»é¡µå®½åº¦ä¼˜åŒ–ï¼Œç¨å¾®æ¯”å±å¹•çª„ä¸€ç‚¹ï¼Œå¢åŠ å³ä¾§è¾¹è·é€‚é…iOS */
      .blog-main-layout {
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
        padding: 0.75rem 0.5rem !important;
        padding-left: 0.5rem !important;
        padding-right: calc(0.5rem + env(safe-area-inset-right, 0px)) !important;
        width: 100% !important;
        max-width: 100vw !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        overflow-x: hidden !important;
      }
      
      @supports (padding: max(0px)) {
        .blog-main-layout {
          padding-right: max(0.5rem, calc(0.5rem + env(safe-area-inset-right))) !important;
        }
      }
      
      /* ç¡®ä¿æ‰€æœ‰å†…å®¹ä¸è¶…å‡ºå±å¹•ï¼ˆä¼˜åŒ–ï¼šå‡å°‘ !importantï¼‰ */
      .blog-content,
      .blog-sidebar-left,
      .blog-sidebar-right {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        padding-left: 0;
        padding-right: 0;
        overflow-x: hidden;
      }
      
      /* æ–‡ç« åˆ—è¡¨ä¸è¶…å‡º */
      .blog-posts-list {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      
      .blog-post-item {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Flex å®¹å™¨é˜²æ­¢æº¢å‡ºï¼ˆå…³é”®å±æ€§ä¿ç•™ !importantï¼‰ */
      .blog-post-item > div {
        flex: 1;
        min-width: 0;
        overflow: hidden;
      }
      
      /* æ–‡æœ¬å†…å®¹é˜²æ­¢æº¢å‡º */
      .blog-post-item .blog-post-title,
      .blog-post-item .blog-post-excerpt {
        overflow: hidden;
        text-overflow: ellipsis;
        word-break: break-word;
      }
      
      /* ç¡®ä¿bodyå’Œhtmlä¸è¶…å‡ºå±å¹•ï¼Œå¢åŠ å³ä¾§è¾¹è·é€‚é…iOSï¼ˆä¼˜åŒ–ï¼šå‡å°‘ä¸å¿…è¦çš„ !importantï¼‰ */
      html, body {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden;
        box-sizing: border-box;
        /* iOSå®‰å…¨åŒºåŸŸé€‚é… - ä½¿ç”¨paddingè€Œä¸æ˜¯margin */
        padding-right: env(safe-area-inset-right, 0px);
      }
      
      /* iOSå®‰å…¨åŒºåŸŸé€‚é… */
      @supports (padding: max(0px)) {
        html, body {
          padding-right: max(0px, env(safe-area-inset-right));
        }
      }
      
      /* ç¡®ä¿æ‰€æœ‰ç›´æ¥å­å…ƒç´ ä¸è¶…å‡ºï¼ˆåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ !importantï¼‰ */
      body > * {
        max-width: 100vw;
        box-sizing: border-box;
      }
      
      /* åªå¯¹å¯èƒ½æº¢å‡ºçš„å®¹å™¨ä½¿ç”¨ overflow-x: hidden */
      body > .blog-main-layout,
      body > .blog-nav {
        overflow-x: hidden;
      }
      
      /* å¯¼èˆªæ å†…å®¹ä¼˜åŒ–ï¼ˆä¼˜åŒ–ï¼šå‡å°‘ !importantï¼‰ */
      .blog-nav-content {
        padding: 0 0.75rem;
        padding-right: calc(0.75rem + env(safe-area-inset-right, 0px));
        width: 100%;
        max-width: 100vw;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      
      @supports (padding: max(0px)) {
        .blog-nav-content {
          padding-right: max(0.75rem, calc(0.75rem + env(safe-area-inset-right)));
        }
      }
      
      /* å¯¼èˆªæ æœ¬èº«ä¹Ÿè¦é™åˆ¶å®½åº¦ */
      .blog-nav {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden;
        box-sizing: border-box;
      }
      .blog-sidebar-left,
      .blog-sidebar-right {
        position: static !important;
        order: 2;
        padding: 0 !important;
        width: 100% !important;
      }
      
      .blog-sidebar-left > div,
      .blog-sidebar-right > div {
        width: 100% !important;
        max-width: 100% !important;
      }
      
      .blog-taxonomy-list,
      #hotPostsList {
        width: 100% !important;
      }
      
      .blog-taxonomy-list a {
        width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* çƒ­é—¨æ–‡ç« å®¹å™¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
      .blog-sidebar-left > div:first-child {
        padding: 0.5rem !important;
        margin-bottom: 0.5rem !important;
        overflow: hidden !important;
      }
      
      .blog-sidebar-left > div:first-child h3 {
        font-size: 0.75rem !important;
        margin-bottom: 0.375rem !important;
      }
      
      /* ç§»åŠ¨ç«¯çƒ­é—¨æ–‡ç« æ¨ªå‘ç´§å‡‘æ˜¾ç¤º */
      #hotPostsList {
        display: flex !important;
        flex-direction: row !important;
        gap: 0.375rem !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        -webkit-overflow-scrolling: touch !important;
        padding: 0.25rem 0 !important;
        scrollbar-width: thin;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* çƒ­é—¨æ–‡ç« å®¹å™¨é˜²æ­¢æº¢å‡º */
      .blog-sidebar-left > div:first-child {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
      }
      
      #hotPostsList::-webkit-scrollbar {
        height: 4px;
      }
      
      #hotPostsList::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 2px;
      }
      
      #hotPostsList a {
        flex-shrink: 0 !important;
        width: auto !important;
        min-width: 100px !important;
        max-width: 150px !important;
        padding: 0.375rem 0.5rem !important;
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 0.375rem !important;
        border-radius: 0.25rem !important;
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        box-sizing: border-box !important;
        text-decoration: none !important;
      }
      
      #hotPostsList a > span:first-child {
        width: 16px !important;
        height: 16px !important;
        font-size: 0.625rem !important;
        flex-shrink: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }
      
      #hotPostsList a > div {
        flex: 1 !important;
        min-width: 0 !important;
        display: flex !important;
        flex-direction: column !important;
        gap: 0.125rem !important;
        overflow: hidden !important;
      }
      
      #hotPostsList a > div > div:first-child {
        font-size: 0.6875rem !important;
        line-height: 1.2 !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        word-break: break-word !important;
        color: #374151 !important;
        font-weight: 500 !important;
        text-overflow: ellipsis !important;
      }
      
      #hotPostsList a > div > div:last-child {
        font-size: 0.625rem !important;
        color: #9ca3af !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
      }
      
      /* è¶…å°å±å¹•è¿›ä¸€æ­¥ä¼˜åŒ– */
      @media (max-width: 480px) {
        #hotPostsList {
          gap: 0.25rem !important;
        }
        
        #hotPostsList a {
          min-width: 90px !important;
          max-width: 130px !important;
          padding: 0.25rem 0.375rem !important;
          gap: 0.25rem !important;
        }
        
        #hotPostsList a > span:first-child {
          width: 14px !important;
          height: 14px !important;
          font-size: 0.5625rem !important;
        }
        
        #hotPostsList a > div > div:first-child {
          font-size: 0.625rem !important;
          -webkit-line-clamp: 1 !important;
        }
        
        #hotPostsList a > div > div:last-child {
          font-size: 0.5625rem !important;
        }
      }
      
      .blog-content {
        order: 1;
      }
      
      /* åˆ—è¡¨å®¹å™¨ä¼˜åŒ– */
      .blog-posts-list {
        gap: 0 !important;
      }
      
      .blog-post-item {
        border-bottom: 1px solid #f3f4f6 !important;
      }
      
      /* åˆ†é¡µé—´è·ä¼˜åŒ– */
      .blog-pagination {
        margin-top: 1rem !important;
        margin-bottom: 0.75rem !important;
        gap: 0.375rem !important;
      }
      
      .blog-pagination-btn {
        min-width: 32px !important;
        height: 32px !important;
        padding: 0 0.5rem !important;
        font-size: 0.8125rem !important;
      }
      
      /* ç§»åŠ¨ç«¯åˆ—è¡¨é¡¹ä¼˜åŒ– - æ¨ªå‘ç´§å‡‘å¸ƒå±€ï¼Œä¸€è¡Œæ˜¾ç¤º */
      .blog-post-item,
      article.blog-post-item {
        flex-direction: row !important;
        align-items: center !important;
        padding: 0.5rem 0.75rem !important;
        gap: 0.5rem !important;
        min-height: auto !important;
        display: flex !important;
        position: relative !important;
      }
      
      /* ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®ç§»åŠ¨ç«¯ä¼˜åŒ– - è°ƒæ•´ä½ç½®é¿å…é®æŒ¡ */
      .blog-post-item .blog-post-actions {
        position: absolute !important;
        right: 0.5rem !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        z-index: 10 !important;
        flex-direction: column !important;
        gap: 0.25rem !important;
      }
      
      .blog-post-item .blog-post-actions .blog-post-edit-btn,
      .blog-post-item .blog-post-actions .blog-post-delete-btn {
        padding: 0.375rem 0.5rem !important;
        font-size: 0.75rem !important;
        gap: 0.25rem !important;
      }
      
      .blog-post-item .blog-post-actions span {
        display: none !important;
      }
      
      /* ç§»åŠ¨ç«¯ç¡®ä¿å†…å®¹ä¸è¢«æŒ‰é’®é®æŒ¡ */
      .blog-post-item:has(.blog-post-actions) > div:nth-child(2) {
        padding-right: 5rem !important;
      }
      
      /* ä¸­é—´å†…å®¹åŒºåŸŸç§»åŠ¨ç«¯æ·»åŠ å³è¾¹è·ï¼Œé¿å…è¢«ç¼–è¾‘æŒ‰é’®é®æŒ¡ */
      .blog-post-item > div:nth-of-type(2) {
        padding-right: 2rem;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      /* æ ‡é¢˜é˜²æ­¢æº¢å‡º */
      .blog-post-item .blog-post-title {
        overflow: hidden;
        text-overflow: ellipsis;
        word-break: break-word;
      }
      
      /* å›¾ç‰‡ç¼©å° - ç¼©ç•¥å›¾å¯ç‚¹å‡» */
      .blog-post-item > a:first-child {
        width: 50px !important;
        height: 50px !important;
        flex-shrink: 0 !important;
        display: block !important;
      }
      
      /* ç§»åŠ¨ç«¯éšè—å³ä¾§å…ƒä¿¡æ¯ï¼ˆä½¿ç”¨classé€‰æ‹©å™¨ï¼Œæ›´ç²¾ç¡®ï¼‰ */
      .blog-post-item .blog-post-meta {
        display: none !important;
      }
      
      /* ä¸­é—´å†…å®¹åŒºåŸŸä¼˜åŒ– */
      .blog-post-item > div:nth-of-type(2) {
        flex: 1 !important;
        min-width: 0 !important;
        gap: 0.25rem !important;
      }
      
      /* æ ‡é¢˜å’Œåˆ†ç±»ä¸€è¡Œæ˜¾ç¤º */
      .blog-post-item > div:nth-of-type(2) > div:first-child {
        display: flex !important;
        align-items: center !important;
        gap: 0.375rem !important;
        flex-wrap: wrap !important;
      }
      
      /* æ ‡é¢˜æ ·å¼ä¼˜åŒ– */
      .blog-post-item .blog-post-title {
        font-size: 0.875rem !important;
        line-height: 1.3 !important;
        -webkit-line-clamp: 2 !important;
        flex: 1 !important;
        min-width: 0 !important;
      }
      
      /* åˆ†ç±»æ ‡ç­¾ç¼©å° */
      .blog-post-item .blog-post-title + a {
        font-size: 0.6875rem !important;
        padding: 0.125rem 0.375rem !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
      }
      
      /* æ‘˜è¦éšè—æˆ–å•è¡Œæ˜¾ç¤º */
      .blog-post-item .blog-post-excerpt {
        font-size: 0.75rem !important;
        -webkit-line-clamp: 1 !important;
        margin: 0 !important;
        display: none !important; /* æ‰‹æœºç«¯éšè—æ‘˜è¦ä»¥èŠ‚çœç©ºé—´ */
      }
      
      /* åº•éƒ¨ä¿¡æ¯è¡Œä¼˜åŒ– */
      .blog-post-item > div:nth-of-type(2) > div:last-child {
        font-size: 0.6875rem !important;
        gap: 0.5rem !important;
        margin-top: 0.125rem !important;
      }
      
      /* åº•éƒ¨ä¿¡æ¯å›¾æ ‡å’Œæ–‡å­— */
      .blog-post-item > div:nth-child(2) > div:last-child span {
        font-size: 0.6875rem !important;
      }
      
      .blog-post-item > div:nth-child(2) > div:last-child svg {
        width: 10px !important;
        height: 10px !important;
      }
      .blog-nav-content {
        flex-direction: column;
        gap: 0.75rem;
        padding: 0.75rem 0;
      }
      .blog-nav-actions {
        width: 100%;
      }
      .blog-search {
        max-width: 100% !important;
      }
    }
    
    /* å°æ‰‹æœºï¼ˆ<480pxï¼‰ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ›´ç´§å‡‘ */
    @media (max-width: 480px) {
      .blog-post-item {
        padding: 0.375rem 0.5rem !important;
        gap: 0.375rem !important;
      }
      
      .blog-post-item > a:first-child {
        width: 40px !important;
        height: 40px !important;
      }
      
      .blog-post-title {
        font-size: 0.8125rem !important;
        line-height: 1.25 !important;
      }
      
      .blog-post-item .blog-post-title + a {
        font-size: 0.625rem !important;
        padding: 0.125rem 0.25rem !important;
      }
      
      .blog-post-item > div:nth-child(2) > div:last-child {
        font-size: 0.625rem !important;
        gap: 0.375rem !important;
      }
      
      .blog-post-item > div:nth-child(2) > div:last-child svg {
        width: 9px !important;
        height: 9px !important;
      }
    }
  </style>

  <!-- é¡µè„š -->
  <footer class="blog-footer">
    <div class="blog-footer-content">
      <div class="blog-footer-text">Â© 2024 DevBlog. All rights reserved.</div>
      <div class="blog-footer-links">
        <a href="/feed.xml" class="blog-footer-link" title="RSS è®¢é˜…">RSS</a>
      </div>
    </div>
  </footer>

  <!-- è„šæœ¬ -->
  <script src="/utils/blog.js"></script>
  <script>
    // å½“å‰é¡µç 
    let currentPage = 1;
    const pageSize = 12; // å¢åŠ æ¯é¡µæ˜¾ç¤ºæ•°é‡
    let totalPages = 1;
    let currentCategory = null;
    let currentSearch = null;
    let viewMode = 'posts'; // å›ºå®šä¸ºæ–‡ç« åˆ—è¡¨æ¨¡å¼
    let isAdminLoggedIn = false; // ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
    let showMyPostsOnly = false; // æ˜¯å¦åªæ˜¾ç¤ºæˆ‘çš„æ–‡ç« 

    // åˆå§‹åŒ–ç²’å­èƒŒæ™¯
    function initParticles() {
      const container = document.getElementById('particles');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 100 + 50;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.opacity = Math.random() * 0.3 + 0.1;
        container.appendChild(particle);
      }
    }

    // å¯çˆ±çš„åŠ è½½æç¤ºæ–‡å­—æ•°ç»„
    const postsLoadingMessages = [
      'ğŸ“š æ­£åœ¨æ•´ç†æ–‡ç« åˆ—è¡¨...',
      'âœ¨ é­”æ³•æ­£åœ¨å‘ç”Ÿä¸­...',
      'ğŸ± å°çŒ«å’ªæ­£åœ¨å¸®ä½ æ‰¾æ–‡ç« ...',
      'ğŸš€ åŠ é€ŸåŠ è½½ä¸­...',
      'ğŸ’« æ–‡ç« ä»¬æ­£åœ¨èµ¶æ¥...',
      'ğŸ¨ æ­£åœ¨ç¾åŒ–æ–‡ç« åˆ—è¡¨...',
      'ğŸŒŸ é©¬ä¸Šå°±å¥½å•¦...',
      'ğŸ“– æ­£åœ¨ç¿»é˜…æ–‡ç« åº“...',
      'ğŸ¯ ç²¾å‡†å®šä½æ–‡ç« ä¸­...',
      'ğŸ’¡ çµæ„Ÿæ­£åœ¨åŠ è½½...'
    ];
    
    // å¯çˆ±çš„è¡¨æƒ…ç¬¦å·æ•°ç»„
    const postsLoadingEmojis = [
      'ğŸ“šâœ¨', 'ğŸ±', 'ğŸš€', 'ğŸ’«', 'ğŸ¨', 'ğŸŒŸ', 'ğŸ“–', 'ğŸ¯', 'ğŸ’¡', 'âœ¨'
    ];
    
    // æ›´æ–°åŠ è½½æç¤ºæ–‡å­—å’Œè¡¨æƒ…
    function updatePostsLoadingMessage() {
      const loadingText = document.getElementById('postsLoadingText');
      const loadingEmoji = document.getElementById('postsLoadingEmoji');
      
      if (loadingText) {
        const randomMessage = postsLoadingMessages[Math.floor(Math.random() * postsLoadingMessages.length)];
        loadingText.textContent = randomMessage;
      }
      
      if (loadingEmoji) {
        const randomEmoji = postsLoadingEmojis[Math.floor(Math.random() * postsLoadingEmojis.length)];
        loadingEmoji.textContent = randomEmoji;
        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
        loadingEmoji.style.animation = 'rotateEmoji 2s ease-in-out infinite';
      }
    }

    // åŠ è½½æ–‡ç« åˆ—è¡¨
    async function loadPosts(page = 1) {
      // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ï¼ˆå¹³æ»‘æ»šåŠ¨ï¼‰
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
      
      const loadingAnimation = document.getElementById('postsLoadingAnimation');
      const postsGrid = document.getElementById('postsGrid');
      const progressBar = document.getElementById('postsLoadingProgressBar');
      
      try {
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        if (loadingAnimation) {
          loadingAnimation.style.display = 'block';
        }
        if (postsGrid) {
          postsGrid.style.display = 'none';
        }
        
        // åˆå§‹åŒ–åŠ è½½æç¤º
        updatePostsLoadingMessage();
        
        // æ¯2ç§’æ›´æ–°ä¸€æ¬¡åŠ è½½æç¤ºï¼Œè®©ç­‰å¾…æ›´æœ‰è¶£
        const messageInterval = setInterval(() => {
          updatePostsLoadingMessage();
        }, 2000);
        
        // æ¨¡æ‹Ÿè¿›åº¦åŠ¨ç”»
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += Math.random() * 5 + 2; // éšæœºå¢åŠ 2-7%
          if (progressBar && progress < 85) {
            progressBar.style.width = Math.min(progress, 85) + '%';
          }
        }, 150);
        
        const options = {
          page,
          pageSize,
          published: 'true'
        };
        
        if (currentCategory) {
          options.category = currentCategory;
        }
        if (currentSearch) {
          options.search = currentSearch;
        }
        
        // å¦‚æœç”¨æˆ·å·²ç™»å½•ä¸”å¯ç”¨äº†"æˆ‘çš„æ–‡ç« "ç­›é€‰
        if (blogCurrentUser && showMyPostsOnly) {
          options.myPosts = 'true';
        }
        
        const response = await getPosts(options);
        
        // æ¸…é™¤è¿›åº¦åŠ¨ç”»å’Œæ¶ˆæ¯æ›´æ–°
        clearInterval(progressInterval);
        clearInterval(messageInterval);
        
        if (response.success) {
          // æ›´æ–°åŠ è½½æç¤ºä¸ºæˆåŠŸæ¶ˆæ¯
          const loadingText = document.getElementById('postsLoadingText');
          const loadingEmoji = document.getElementById('postsLoadingEmoji');
          if (loadingText) {
            loadingText.textContent = `âœ… æˆåŠŸåŠ è½½ ${response.data.length} ç¯‡æ–‡ç« ï¼`;
            loadingText.style.color = '#10b981';
          }
          if (loadingEmoji) {
            loadingEmoji.textContent = 'ğŸ‰';
            loadingEmoji.style.animation = 'bounce 0.5s ease-in-out 3';
          }
          
          // å®Œæˆè¿›åº¦æ¡
          if (progressBar) {
            progressBar.style.width = '100%';
          }
          
          // å»¶è¿Ÿæ˜¾ç¤ºå†…å®¹ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸçŠ¶æ€
          setTimeout(() => {
            displayPosts(response.data);
            currentPage = response.pagination.currentPage;
            totalPages = response.pagination.totalPages;
            displayPagination();
            
            // éšè—åŠ è½½åŠ¨ç”»ï¼Œæ˜¾ç¤ºå†…å®¹
            if (loadingAnimation) {
              loadingAnimation.style.display = 'none';
            }
            if (postsGrid) {
              postsGrid.style.display = 'flex';
            }
            
            // é‡ç½®åŠ è½½æç¤º
            if (loadingText) {
              loadingText.textContent = 'æ­£åœ¨åŠ è½½æ–‡ç« ...';
              loadingText.style.color = '#6b7280';
            }
            if (loadingEmoji) {
              loadingEmoji.textContent = 'ğŸ“šâœ¨';
              loadingEmoji.style.animation = 'bounce 1s ease-in-out infinite';
            }
            if (progressBar) {
              progressBar.style.width = '0%';
            }
            
            // æ›´æ–°ç¼–è¾‘æŒ‰é’®æ˜¾ç¤º
            if (isAdminLoggedIn) {
              updateEditButtons();
            }
          }, 500);
        } else {
          // éšè—åŠ è½½åŠ¨ç”»
          if (loadingAnimation) {
            loadingAnimation.style.display = 'none';
          }
          if (postsGrid) {
            postsGrid.style.display = 'flex';
          }
          showToast('åŠ è½½æ–‡ç« å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
        // éšè—åŠ è½½åŠ¨ç”»
        if (loadingAnimation) {
          loadingAnimation.style.display = 'none';
        }
        if (postsGrid) {
          postsGrid.style.display = 'flex';
        }
        showToast('åŠ è½½æ–‡ç« å¤±è´¥: ' + error.message, 'error');
        document.getElementById('postsGrid').innerHTML = '<div class="blog-empty">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
      }
    }


    // æ¸…é™¤ç­›é€‰æ¡ä»¶
    function clearFilters() {
      currentCategory = null;
      currentSearch = null;
      showMyPostsOnly = false; // åŒæ—¶æ¸…é™¤"æˆ‘çš„æ–‡ç« "ç­›é€‰
      currentPage = 1;
      
      
      // æ¸…é™¤æœç´¢æ¡†
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.value = '';
      }
      
      // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
      updateMyPostsFilterButton();
      
      // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
      loadCategories();
      
      // é‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨
      loadPosts(1);
      
      showToast('å·²æ¸…é™¤ç­›é€‰æ¡ä»¶', 'info');
    }


    // æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼ˆè®ºå›é£æ ¼ï¼‰
    function displayPosts(posts) {
      const grid = document.getElementById('postsGrid');
      
      if (!posts || posts.length === 0) {
        grid.innerHTML = '<div class="blog-empty" style="padding: 2rem; text-align: center; color: #9ca3af;">æš‚æ— æ–‡ç« </div>';
        return;
      }
      
      grid.innerHTML = posts.map((post, index) => {
        const imageUrl = post.image || '';
        const date = formatDate(post.createdAt || post.created_at);
        // categoryå­—æ®µä½œä¸ºæ ‡ç­¾ä½¿ç”¨
        const category = post.category || post._sourceApiName || '';
        const apiName = post._sourceApiName || '';
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹æ®Šç±»åˆ«ï¼Œéœ€è¦å®šåˆ¶æ˜¾ç¤º
        const isExchangeRate = apiName.toLowerCase().includes('exchange') || apiName.toLowerCase().includes('æ±‡ç‡');
        const isTranslation = apiName.toLowerCase().includes('translation') || apiName.toLowerCase().includes('ç¿»è¯‘');
        const isWeather = apiName.toLowerCase().includes('weather') || apiName.toLowerCase().includes('å¤©æ°”');
        
        // è®ºå›é£æ ¼ï¼šæ‰€æœ‰å†…å®¹éƒ½è½¬æ¢ä¸ºæ‘˜è¦å½¢å¼
        let excerpt = '';
        
        if (isWeather && post._originalData) {
          // å¤©æ°”è·¯å†µï¼šæ˜¾ç¤ºé¢„è­¦æ‘˜è¦
          if (post._originalData.globalAlert && post._originalData.globalAlert.message) {
            const message = post._originalData.globalAlert.message;
            excerpt = 'âš ï¸ ' + truncate(message, 60);
            const infoParts = [];
            if (post._originalData.attractions && post._originalData.attractions.length > 0) {
              infoParts.push(`${post._originalData.attractions.length}ä¸ªæ™¯ç‚¹`);
            }
            if (post._originalData.traffic && post._originalData.traffic.length > 0) {
              infoParts.push(`${post._originalData.traffic.length}æ¡è·¯å†µ`);
            }
            if (infoParts.length > 0) {
              excerpt += ' â€¢ ' + infoParts.join(' â€¢ ');
            }
          } else {
            excerpt = truncate(post.excerpt || post.description || '', 80);
          }
        } else if (isExchangeRate && post._originalData) {
          // æ±‡ç‡è½¬æ¢ï¼šæ˜¾ç¤ºç®€è¦æ±‡ç‡ä¿¡æ¯
          const excludeFields = ['id', 'name', 'title', 'slug', 'excerpt', 'description', 'htmlContent', 'image', 'category', 'published', 'views', 'createdAt', 'updatedAt', 'detailApi', 'updateTime'];
          const currencies = Object.keys(post._originalData).filter(k => 
            !excludeFields.includes(k) && 
            post._originalData[k] && 
            typeof post._originalData[k] === 'object' && 
            !Array.isArray(post._originalData[k])
          );
          
          if (currencies.length > 0) {
            const firstCurrency = currencies[0];
            const firstRate = post._originalData[firstCurrency];
            if (firstRate && typeof firstRate === 'object') {
              const firstTarget = Object.keys(firstRate)[0];
              const rateValue = firstRate[firstTarget];
              if (typeof rateValue === 'number') {
                excerpt = `${firstCurrency} â†’ ${firstTarget}: ${rateValue.toFixed(4)}`;
                if (currencies.length > 1) {
                  excerpt += ` (å…±${currencies.length}ç§)`;
                }
              } else {
                excerpt = truncate(post.excerpt || post.description || '', 80);
              }
            } else {
              excerpt = truncate(post.excerpt || post.description || '', 80);
            }
          } else {
            excerpt = truncate(post.excerpt || post.description || '', 80);
          }
        } else if (isTranslation && post._originalData) {
          // ç¿»è¯‘å¡ç‰‡ï¼šæ˜¾ç¤ºä¸­é˜¿å¯¹ç…§æ‘˜è¦
          if (post._originalData.chinese && post._originalData.arabic) {
            excerpt = `${escapeHtml(truncate(post._originalData.chinese, 35))} / ${escapeHtml(truncate(post._originalData.arabic, 35))}`;
          } else {
            excerpt = truncate(post.excerpt || post.description || '', 80);
          }
        } else {
          excerpt = truncate(post.excerpt || post.description || '', 80);
        }
        
        const views = post.views || 0;
        const comments = post.comments || 0;
        
        // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®ï¼šç®¡ç†å‘˜ç™»å½• æˆ– ç”¨æˆ·æ‰‹æœºå·ä¸æ–‡ç« deviceIdä¸€è‡´
        const canEdit = isAdminLoggedIn || post.canEdit;
        
        // è®ºå›é£æ ¼ï¼šç®€æ´åˆ—è¡¨å¸ƒå±€
        return `
          <article class="blog-post-item" style="display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #f3f4f6; background: white; transition: background 0.2s; position: relative;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
            <!-- å·¦ä¾§ç¼©ç•¥å›¾ - å¯ç‚¹å‡»è·³è½¬ -->
            <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" style="flex-shrink: 0; width: 60px; height: 60px; border-radius: 0.25rem; overflow: hidden; background: linear-gradient(to bottom right, #f5f5f5, #e5e5e5); display: block; text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
              ${imageUrl ? `<img src="${imageUrl}" alt="${escapeHtml(post.name || post.title || '')}" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;">` : '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#9ca3af;font-size:1.25rem;">ğŸ“„</div>'}
            </a>
            <!-- ä¸­é—´å†…å®¹åŒº -->
            <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 0.375rem;">
              <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" class="blog-post-title" style="font-size: 0.9375rem; font-weight: 600; color: #111827; text-decoration: none; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;" onmouseover="this.style.color='#d97706'" onmouseout="this.style.color='#111827'">
                ${escapeHtml(post.name || post.title || 'æœªå‘½å')}
              </a>
              <!-- åˆ†ç±»ã€æ—¥æœŸã€æµè§ˆæ¬¡æ•° - æ ‡é¢˜ä¸‹æ–¹ -->
              <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; font-size: 0.75rem; color: #9ca3af;">
                ${category ? `<a href="#" onclick="filterByCategory('${escapeHtml(category)}'); return false;" style="display: inline-flex; align-items: center; padding: 0.1875rem 0.5rem; background: #f3f4f6; color: #6b7280; border-radius: 0.25rem; font-weight: 500; text-decoration: none; transition: background 0.2s; white-space: nowrap;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">${escapeHtml(category)}</a>` : ''}
                ${(!post.published || post.published === false) && post.canEdit ? `<span style="display: inline-flex; align-items: center; padding: 0.1875rem 0.5rem; background: #fef3c7; color: #92400e; border-radius: 0.25rem; font-weight: 500; white-space: nowrap;">ğŸ“ è‰ç¨¿</span>` : ''}
                <span style="white-space: nowrap;">${date}</span>
                ${views > 0 ? `<span style="display: inline-flex; align-items: center; gap: 0.25rem; white-space: nowrap;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  ${views}
                </span>` : ''}
              </div>
              ${excerpt ? `<p class="blog-post-excerpt" style="font-size: 0.8125rem; color: #6b7280; line-height: 1.4; margin: 0; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">${escapeHtml(excerpt)}</p>` : ''}
              ${(post.nickname || post.phone) ? `<div style="display: flex; align-items: center; gap: 0.75rem; font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                ${post.nickname ? `<span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  ${escapeHtml(post.nickname)}
                </span>` : ''}
                ${post.phone ? `<span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                  </svg>
                  ${escapeHtml(post.phone)}
                </span>` : ''}
              </div>` : ''}
            </div>
            ${canEdit ? `
              <div class="blog-post-actions" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.5rem !important; z-index: 20;">
                <button class="blog-post-edit-btn" onclick="editPost('${post.id}'); event.stopPropagation();" title="ç¼–è¾‘æ–‡ç« " style="position: static !important; display: inline-flex !important; align-items: center; justify-content: center; gap: 0.375rem; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); border: 1px solid rgba(229,231,235,0.8); border-radius: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.8125rem; font-weight: 500; color: #374151; cursor: pointer; opacity: 0.8; transition: all 0.2s; white-space: nowrap; width: auto !important; height: auto !important;" onmouseover="this.style.opacity='1'; this.style.background='rgba(255,255,255,1)'; this.style.borderColor='#d97706'; this.style.color='#d97706'" onmouseout="this.style.opacity='0.8'; this.style.background='rgba(255,255,255,0.9)'; this.style.borderColor='rgba(229,231,235,0.8)'; this.style.color='#374151'">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                  <span>ç¼–è¾‘</span>
                </button>
                <span style="color: #d1d5db; font-size: 0.875rem; flex-shrink: 0;">|</span>
                <button class="blog-post-delete-btn" onclick="deletePost('${post.id}'); event.stopPropagation();" title="åˆ é™¤æ–‡ç« " style="position: static !important; display: inline-flex !important; align-items: center; justify-content: center; gap: 0.375rem; background: rgba(239,68,68,0.1); backdrop-filter: blur(4px); border: 1px solid rgba(239,68,68,0.3); border-radius: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.8125rem; font-weight: 500; color: #ef4444; cursor: pointer; opacity: 0.8; transition: all 0.2s; white-space: nowrap; width: auto !important; height: auto !important;" onmouseover="this.style.opacity='1'; this.style.background='rgba(239,68,68,0.15)'; this.style.borderColor='#ef4444'" onmouseout="this.style.opacity='0.8'; this.style.background='rgba(239,68,68,0.1)'; this.style.borderColor='rgba(239,68,68,0.3)'">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                  <span>åˆ é™¤</span>
                </button>
              </div>
            ` : ''}
          </article>
        `;
      }).join('');
    }

    // æ˜¾ç¤ºåˆ†é¡µï¼ˆä¼˜åŒ–æ˜¾ç¤ºæ›´å¤šé¡µç ï¼‰
    function displayPagination() {
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      // ä¸Šä¸€é¡µ
      if (currentPage > 1) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage - 1}); return false;" style="display: inline-flex; align-items: center; gap: 0.25rem;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
          <span>ä¸Šä¸€é¡µ</span>
        </a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.4; cursor: not-allowed; display: inline-flex; align-items: center; gap: 0.25rem;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
          <span>ä¸Šä¸€é¡µ</span>
        </span>`;
      }
      
      // é¡µç æ˜¾ç¤ºé€»è¾‘ï¼šæ˜¾ç¤ºå½“å‰é¡µå‰åå„2é¡µï¼Œä»¥åŠé¦–å°¾é¡µ
      const maxVisiblePages = 7; // æœ€å¤šæ˜¾ç¤º7ä¸ªé¡µç æŒ‰é’®
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      // å¦‚æœå³ä¾§é¡µç ä¸è¶³ï¼Œå‘å·¦è°ƒæ•´
      if (endPage - startPage < maxVisiblePages - 1) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      // æ˜¾ç¤ºé¦–é¡µ
      if (startPage > 1) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(1); return false;">1</a>`;
        if (startPage > 2) {
          html += `<span class="blog-pagination-btn" style="border: none; background: transparent; cursor: default; color: #9ca3af;">...</span>`;
        }
      }
      
      // æ˜¾ç¤ºé¡µç èŒƒå›´
      for (let i = startPage; i <= endPage; i++) {
        if (i === currentPage) {
          html += `<span class="blog-pagination-btn active">${i}</span>`;
        } else {
          html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${i}); return false;">${i}</a>`;
        }
      }
      
      // æ˜¾ç¤ºæœ«é¡µ
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          html += `<span class="blog-pagination-btn" style="border: none; background: transparent; cursor: default; color: #9ca3af;">...</span>`;
        }
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${totalPages}); return false;">${totalPages}</a>`;
      }
      
      // ä¸‹ä¸€é¡µ
      if (currentPage < totalPages) {
        html += `<a href="#" class="blog-pagination-btn" onclick="loadPosts(${currentPage + 1}); return false;" style="display: inline-flex; align-items: center; gap: 0.25rem;">
          <span>ä¸‹ä¸€é¡µ</span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </a>`;
      } else {
        html += `<span class="blog-pagination-btn" style="opacity: 0.4; cursor: not-allowed; display: inline-flex; align-items: center; gap: 0.25rem;">
          <span>ä¸‹ä¸€é¡µ</span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </span>`;
      }
      
      pagination.innerHTML = html;
    }

    // åŠ è½½åˆ†ç±»
    async function loadCategories() {
      try {
        const response = await getCategories();
        if (response.success) {
          displayCategories(response.data);
        }
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
      }
    }

    // æ˜¾ç¤ºåˆ†ç±»ï¼ˆæ‰å¹³åŒ–æ ·å¼ï¼‰
    function displayCategories(categories) {
      const list = document.getElementById('categoriesList');
      
      if (!categories || categories.length === 0) {
        list.innerHTML = '<span style="color: #9ca3af; font-size: 0.875rem;">æš‚æ— åˆ†ç±»</span>';
        return;
      }
      
      list.innerHTML = categories.map(cat => {
        const count = cat.postCount || 0;
        const isActive = currentCategory === cat.name;
        return `<a href="#" onclick="filterByCategory('${escapeHtml(cat.name)}'); return false;" style="display: flex; align-items: center; justify-content: space-between; padding: 0.375rem 0.5rem; border-radius: 0.25rem; text-decoration: none; font-size: 0.8125rem; color: ${isActive ? '#d97706' : '#374151'}; background: ${isActive ? '#fef3c7' : 'transparent'}; font-weight: ${isActive ? '600' : '500'}; transition: all 0.2s; width: 100%; box-sizing: border-box; word-break: break-word;" onmouseover="if(!${isActive}){this.style.background='#f9fafb';}" onmouseout="if(!${isActive}){this.style.background='transparent';}"><span style="flex: 1; min-width: 0; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${escapeHtml(cat.name)}</span><span style="flex-shrink: 0; color: #9ca3af; font-size: 0.75rem; font-weight: normal; margin-left: 0.5rem; text-align: right;">${count}</span></a>`;
      }).join('');
    }


    // æŒ‰åˆ†ç±»ç­›é€‰
    function filterByCategory(category) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰åˆ†ç±»ï¼Œåˆ™å–æ¶ˆç­›é€‰
      if (currentCategory === category) {
        currentCategory = null;
      } else {
        currentCategory = category;
      }
      currentSearch = null;
      currentPage = 1;
      
      // æ¸…é™¤å½’æ¡£ç¼“å­˜ï¼ˆç­›é€‰æ¡ä»¶æ”¹å˜ï¼‰
      archiveCache = null;
      archiveCacheKey = null;
      
      // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
      loadCategories();
      
      // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
      loadPosts(1);
      
      if (currentCategory) {
        showToast(`ç­›é€‰åˆ†ç±»: ${currentCategory}`, 'info');
      } else {
        showToast('å·²æ¸…é™¤åˆ†ç±»ç­›é€‰', 'info');
      }
    }


    // æœç´¢
    function handleSearchKeyPress(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
        if (query) {
          currentSearch = query;
          currentCategory = null;
          currentPage = 1;
          
          // æ¸…é™¤å½’æ¡£ç¼“å­˜ï¼ˆæœç´¢æ¡ä»¶æ”¹å˜ï¼‰
          archiveCache = null;
          archiveCacheKey = null;
          
          // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
          loadPosts(1);
          
          showToast(`æœç´¢: ${query}`, 'info');
        } else {
          // æ¸…é™¤æœç´¢
          currentSearch = null;
          currentPage = 1;
          
          // æ¸…é™¤å½’æ¡£ç¼“å­˜ï¼ˆæœç´¢æ¡ä»¶æ”¹å˜ï¼‰
          archiveCache = null;
          archiveCacheKey = null;
          
          // æ ¹æ®å½“å‰è§†å›¾æ¨¡å¼è°ƒç”¨ç›¸åº”çš„åŠ è½½å‡½æ•°
          loadPosts(1);
        }
      }
    }

    // å½“å‰ç™»å½•ç”¨æˆ·
    let blogCurrentUser = null;
    const API_BASE = '/api';

    // ç™»å½•æµç¨‹çŠ¶æ€
    let blogLoginState = {
      step: 'phone',
      phone: '',
      name: '',
      pin: '',
      pinConfirm: '',
      requiresPinSetup: false,
      checkedPhone: ''
    };

    // è¯·æ±‚IDè®¡æ•°å™¨ï¼Œç”¨äºé˜²æ­¢ç«æ€æ¡ä»¶
    let blogCheckPinStatusRequestId = 0;

    // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
    function showBlogLoginModal() {
      const modal = document.getElementById('blogLoginModal');
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        // èšç„¦åˆ°å§“åè¾“å…¥æ¡†
        setTimeout(() => {
          const nameInput = document.getElementById('blogLoginName');
          if (nameInput) nameInput.focus();
        }, 100);
      }
    }

    // å…³é—­ç™»å½•æ¨¡æ€æ¡†
    function closeBlogLoginModal(event) {
      if (event && event.target !== event.currentTarget) {
        return; // å¦‚æœç‚¹å‡»çš„æ˜¯æ¨¡æ€æ¡†å†…å®¹ï¼Œä¸å…³é—­
      }
      const modal = document.getElementById('blogLoginModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        // æ¸…é™¤è¡¨å•
        const form = document.getElementById('blogLoginForm');
        if (form) form.reset();
        // æ¸…é™¤é”™è¯¯ä¿¡æ¯
        const nameError = document.getElementById('blogLoginNameError');
        const phoneError = document.getElementById('blogLoginPhoneError');
        if (nameError) nameError.style.display = 'none';
        if (phoneError) phoneError.style.display = 'none';
        // é‡ç½®ç™»å½•çŠ¶æ€
        resetBlogLoginState();
      }
    }

    // é‡ç½®ç™»å½•çŠ¶æ€
    function resetBlogLoginState() {
      blogLoginState = {
        step: 'phone',
        phone: '',
        name: '',
        pin: '',
        pinConfirm: '',
        requiresPinSetup: false,
        checkedPhone: ''
      };
      // éšè—PINåŒºåŸŸ
      const pinSection = document.getElementById('blogPinSection');
      if (pinSection) pinSection.style.display = 'none';
      const pinConfirmSection = document.getElementById('blogPinConfirmSection');
      if (pinConfirmSection) pinConfirmSection.style.display = 'none';
      // æ¸…é™¤PINè¾“å…¥
      clearBlogPinInputs('pin');
      clearBlogPinInputs('pinConfirm');
    }

    // æ£€æŸ¥PINçŠ¶æ€
    async function checkBlogPinStatus(phone, requestId) {
      if (!requestId) {
        requestId = ++blogCheckPinStatusRequestId;
      }
      
      try {
        const response = await fetch(`${API_BASE}/auth/user/check-pin-status`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ phone })
        });
        
        // æ£€æŸ¥è¿™ä¸ªè¯·æ±‚æ˜¯å¦è¿˜æ˜¯æœ€æ–°çš„
        if (requestId !== blogCheckPinStatusRequestId) {
          return false;
        }
        
        // å†æ¬¡éªŒè¯æ‰‹æœºå·æ˜¯å¦è¿˜æ˜¯å½“å‰è¾“å…¥çš„å€¼
        const currentPhone = document.getElementById('blogLoginPhone').value.trim();
        if (currentPhone !== phone || currentPhone.length !== 11 || !currentPhone.startsWith('0')) {
          return false;
        }
        
        if (!response.ok) {
          let errorData = {};
          try {
            errorData = await response.json();
          } catch (e) {
            errorData = { message: response.statusText || 'Request failed' };
          }
          
          if (response.status === 403 && (errorData.message || '').includes('IP')) {
            blogLoginState.checkedPhone = '';
            return false;
          }
          blogLoginState.checkedPhone = '';
          return false;
        }
        
        const data = await response.json();
        
        // å†æ¬¡æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¿˜æ˜¯æœ€æ–°çš„
        if (requestId !== blogCheckPinStatusRequestId) {
          return false;
        }
        
        // å†æ¬¡éªŒè¯æ‰‹æœºå·
        const currentPhone2 = document.getElementById('blogLoginPhone').value.trim();
        if (currentPhone2 !== phone || currentPhone2.length !== 11 || !currentPhone2.startsWith('0')) {
          return false;
        }
        
        if (data.success !== undefined) {
          blogLoginState.checkedPhone = phone;
          
          if (data.hasPin) {
            // ç”¨æˆ·å·²æœ‰PINï¼Œæ˜¾ç¤ºPINè¾“å…¥åŒºåŸŸ
            showBlogPinSection(false);
            return true;
          } else {
            // ç”¨æˆ·æ²¡æœ‰PINï¼Œæ˜¾ç¤ºPINè®¾ç½®åŒºåŸŸ
            showBlogPinSection(true);
            return true;
          }
        }
        
        return false;
      } catch (error) {
        console.error('æ£€æŸ¥PINçŠ¶æ€å¤±è´¥:', error);
        return false;
      }
    }

    // æ˜¾ç¤ºPINåŒºåŸŸ
    function showBlogPinSection(requiresSetup = false) {
      const pinSection = document.getElementById('blogPinSection');
      const pinConfirmSection = document.getElementById('blogPinConfirmSection');
      const pinLabel = document.getElementById('blogPinLabel');
      
      if (pinSection) {
        pinSection.style.display = 'block';
        
        if (requiresSetup) {
          // é¦–æ¬¡è®¾ç½®PINï¼Œéœ€è¦ç¡®è®¤
          blogLoginState.requiresPinSetup = true;
          if (pinConfirmSection) {
            pinConfirmSection.style.display = 'block';
          }
          if (pinLabel) {
            pinLabel.textContent = 'è®¾ç½®PINç ';
          }
        } else {
          // å·²æœ‰PINï¼Œåªéœ€è¾“å…¥
          blogLoginState.requiresPinSetup = false;
          if (pinConfirmSection) {
            pinConfirmSection.style.display = 'none';
          }
          if (pinLabel) {
            pinLabel.textContent = 'è¾“å…¥PINç ';
          }
        }
        
        // èšç„¦ç¬¬ä¸€ä¸ªPINè¾“å…¥æ¡†
        setTimeout(() => {
          const pin1 = document.getElementById('blogPin1');
          if (pin1) {
            pin1.focus();
          }
        }, 100);
      }
    }

    // åˆå§‹åŒ–PINè¾“å…¥æ¡†
    function initBlogPinInputs() {
      for (let i = 1; i <= 4; i++) {
        const pinInput = document.getElementById(`blogPin${i}`);
        const pinConfirmInput = document.getElementById(`blogPinConfirm${i}`);
        
        if (pinInput) {
          pinInput.addEventListener('input', (e) => {
            handleBlogPinInput(e, i, 'pin');
          });
          pinInput.addEventListener('keydown', (e) => {
            handleBlogPinKeydown(e, i, 'pin');
          });
          pinInput.addEventListener('paste', (e) => {
            handleBlogPinPaste(e, 'pin');
          });
          pinInput.addEventListener('focus', () => {
            pinInput.style.borderColor = '#d97706';
          });
          pinInput.addEventListener('blur', () => {
            pinInput.style.borderColor = '#d1d5db';
          });
        }
        
        if (pinConfirmInput) {
          pinConfirmInput.addEventListener('input', (e) => {
            handleBlogPinInput(e, i, 'pinConfirm');
          });
          pinConfirmInput.addEventListener('keydown', (e) => {
            handleBlogPinKeydown(e, i, 'pinConfirm');
          });
          pinConfirmInput.addEventListener('paste', (e) => {
            handleBlogPinPaste(e, 'pinConfirm');
          });
          pinConfirmInput.addEventListener('focus', () => {
            pinConfirmInput.style.borderColor = '#d97706';
          });
          pinConfirmInput.addEventListener('blur', () => {
            pinConfirmInput.style.borderColor = '#d1d5db';
          });
        }
      }
    }

    // å¤„ç†PINè¾“å…¥
    function handleBlogPinInput(e, index, type) {
      const input = e.target;
      const value = input.value.replace(/\D/g, ''); // åªä¿ç•™æ•°å­—
      
      if (value) {
        input.value = value.charAt(0);
        input.style.borderColor = '#10b981';
        input.style.backgroundColor = '#f0fdf4';
        
        // è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥æ¡†
        if (index < 4) {
          const nextInput = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${index + 1}`);
          if (nextInput) {
            nextInput.focus();
          }
        } else {
          // æœ€åä¸€ä¸ªè¾“å…¥æ¡†
          if (type === 'pin' && blogLoginState.requiresPinSetup) {
            // å¦‚æœæ˜¯è®¾ç½®PINæ¨¡å¼ï¼Œè¾“å…¥å®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°Confirm PINçš„ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†
            const pinConfirm1 = document.getElementById('blogPinConfirm1');
            if (pinConfirm1) {
              setTimeout(() => {
                pinConfirm1.focus();
              }, 100);
            }
          } else {
            input.blur();
          }
        }
      } else {
        input.style.borderColor = '#d1d5db';
        input.style.backgroundColor = '';
      }
      
      updateBlogPinValue(type);
    }

    // å¤„ç†PINé€€æ ¼é”®
    function handleBlogPinKeydown(e, index, type) {
      if (e.key === 'Backspace' && !e.target.value && index > 1) {
        const prevInput = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${index - 1}`);
        if (prevInput) {
          prevInput.focus();
          prevInput.value = '';
          prevInput.style.borderColor = '#d1d5db';
          prevInput.style.backgroundColor = '';
          updateBlogPinValue(type);
        }
      }
    }

    // å¤„ç†PINç²˜è´´
    function handleBlogPinPaste(e, type) {
      e.preventDefault();
      const paste = (e.clipboardData || window.clipboardData).getData('text');
      const digits = paste.replace(/\D/g, '').substring(0, 4);
      
      for (let i = 0; i < digits.length; i++) {
        const input = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${i + 1}`);
        if (input) {
          input.value = digits[i];
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = '#f0fdf4';
        }
      }
      
      if (digits.length === 4) {
        const lastInput = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}4`);
        if (lastInput) {
          if (type === 'pin' && blogLoginState.requiresPinSetup) {
            setTimeout(() => {
              const pinConfirm1 = document.getElementById('blogPinConfirm1');
              if (pinConfirm1) pinConfirm1.focus();
            }, 100);
          } else {
            lastInput.blur();
          }
        }
      } else if (digits.length > 0) {
        const nextInput = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${digits.length}`);
        if (nextInput) nextInput.focus();
      }
      
      updateBlogPinValue(type);
    }

    // æ›´æ–°PINå€¼
    function updateBlogPinValue(type) {
      let pinValue = '';
      for (let i = 1; i <= 4; i++) {
        const input = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${i}`);
        if (input) {
          pinValue += input.value;
        }
      }
      
      if (type === 'pin') {
        blogLoginState.pin = pinValue;
        
        // å¦‚æœPINè¾“å…¥å®Œæˆï¼ˆ4ä½ï¼‰ä¸”æ˜¯éªŒè¯æ¨¡å¼ï¼ˆä¸æ˜¯è®¾ç½®æ¨¡å¼ï¼‰ï¼Œè‡ªåŠ¨ç™»å½•
        // ä½†éœ€è¦éªŒè¯æ‰‹æœºå·æ˜¯å¦å·²æ£€æŸ¥å®Œæˆä¸”æœªæ”¹å˜
        if (pinValue.length === 4 && !blogLoginState.requiresPinSetup) {
          const currentPhone = document.getElementById('blogLoginPhone').value.trim();
          // ç¡®ä¿æ‰‹æœºå·æ˜¯å®Œæ•´çš„11ä½0å¼€å¤´ï¼Œä¸”å·²ç»æ£€æŸ¥è¿‡PINçŠ¶æ€
          if (currentPhone.length === 11 && currentPhone.startsWith('0') && 
              currentPhone === blogLoginState.checkedPhone) {
            // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´ï¼Œç¡®ä¿UIæ›´æ–°å®Œæˆ
            setTimeout(async () => {
              // å†æ¬¡éªŒè¯æ‰‹æœºå·æœªæ”¹å˜
              const verifyPhone = document.getElementById('blogLoginPhone').value.trim();
              if (verifyPhone === blogLoginState.checkedPhone && verifyPhone.length === 11 && verifyPhone.startsWith('0')) {
                const form = document.getElementById('blogLoginForm');
                if (form) {
                  // åˆ›å»ºå¹¶è§¦å‘submitäº‹ä»¶
                  const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                  form.dispatchEvent(submitEvent);
                }
              }
            }, 300);
          }
        }
      } else {
        blogLoginState.pinConfirm = pinValue;
        
        // å¦‚æœæ˜¯è®¾ç½®PINæ¨¡å¼ï¼Œä¸”ç¡®è®¤PINè¾“å…¥å®Œæˆï¼ˆ4ä½ï¼‰ï¼Œè‡ªåŠ¨ç™»å½•
        // ä½†éœ€è¦éªŒè¯æ‰‹æœºå·æ˜¯å¦å·²æ£€æŸ¥å®Œæˆä¸”æœªæ”¹å˜
        if (pinValue.length === 4 && blogLoginState.requiresPinSetup && blogLoginState.pin.length === 4) {
          const currentPhone = document.getElementById('blogLoginPhone').value.trim();
          // ç¡®ä¿æ‰‹æœºå·æ˜¯å®Œæ•´çš„11ä½0å¼€å¤´ï¼Œä¸”å·²ç»æ£€æŸ¥è¿‡PINçŠ¶æ€
          if (currentPhone.length === 11 && currentPhone.startsWith('0') && 
              currentPhone === blogLoginState.checkedPhone) {
            // éªŒè¯PINå’Œç¡®è®¤PINæ˜¯å¦åŒ¹é…
            if (blogLoginState.pin === blogLoginState.pinConfirm) {
              // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´ï¼Œç¡®ä¿UIæ›´æ–°å®Œæˆ
              setTimeout(async () => {
                // å†æ¬¡éªŒè¯æ‰‹æœºå·æœªæ”¹å˜
                const verifyPhone = document.getElementById('blogLoginPhone').value.trim();
                if (verifyPhone === blogLoginState.checkedPhone && verifyPhone.length === 11 && verifyPhone.startsWith('0')) {
                  const form = document.getElementById('blogLoginForm');
                  if (form) {
                    // åˆ›å»ºå¹¶è§¦å‘submitäº‹ä»¶
                    const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                    form.dispatchEvent(submitEvent);
                  }
                }
              }, 300);
            }
          }
        }
      }
    }

    // æ¸…é™¤PINè¾“å…¥
    function clearBlogPinInputs(type) {
      if (type === 'both' || type === 'pin') {
        for (let i = 1; i <= 4; i++) {
          const input = document.getElementById(`blogPin${i}`);
          if (input) {
            input.value = '';
            input.style.borderColor = '#d1d5db';
            input.style.backgroundColor = '';
          }
        }
        blogLoginState.pin = '';
      }
      
      if (type === 'both' || type === 'pinConfirm') {
        for (let i = 1; i <= 4; i++) {
          const input = document.getElementById(`blogPinConfirm${i}`);
          if (input) {
            input.value = '';
            input.style.borderColor = '#d1d5db';
            input.style.backgroundColor = '';
          }
        }
        blogLoginState.pinConfirm = '';
        const mismatchError = document.getElementById('blogPinMismatchError');
        if (mismatchError) mismatchError.style.display = 'none';
      }
    }

    // æ˜¾ç¤ºPINé”™è¯¯
    function showBlogPinError(type) {
      for (let i = 1; i <= 4; i++) {
        const input = document.getElementById(`${type === 'pin' ? 'blogPin' : 'blogPinConfirm'}${i}`);
        if (input) {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = '#fef2f2';
          // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»
          input.style.animation = 'shake 0.3s';
          setTimeout(() => {
            input.style.animation = '';
          }, 300);
        }
      }
    }

    // åˆå§‹åŒ–PINè¾“å…¥æ¡†å’Œæ‰‹æœºå·ç›‘å¬
    function initBlogLoginHandlers() {
      // åˆå§‹åŒ–PINè¾“å…¥æ¡†
      initBlogPinInputs();
      
      // æ‰‹æœºå·è¾“å…¥ç›‘å¬
      const phoneInput = document.getElementById('blogLoginPhone');
      const phoneError = document.getElementById('blogLoginPhoneError');
      
      if (phoneInput) {
        let phoneCheckTimeout = null;
        
        // è®°å½•ä¸Šä¸€æ¬¡çš„æ‰‹æœºå·å€¼ï¼Œç”¨äºæ£€æµ‹å˜åŒ–
        let lastPhoneValue = '';
        
        // é™åˆ¶åªèƒ½è¾“å…¥æ•°å­—ï¼Œä¸”å¿…é¡»ä»¥0å¼€å¤´
        phoneInput.addEventListener('input', (e) => {
          // æ£€æŸ¥ Name æ˜¯å¦å·²å¡«å†™
          const nameInput = document.getElementById('blogLoginName');
          const nameValue = nameInput ? nameInput.value.trim() : '';
          if (!nameValue) {
            // Name æœªå¡«å†™ï¼Œæç¤ºç”¨æˆ·å…ˆè¾“å…¥ Name
            const nameError = document.getElementById('blogLoginNameError');
            if (nameError) {
              nameError.textContent = 'è¯·å…ˆè¾“å…¥å§“å';
              nameError.style.display = 'block';
            }
            if (nameInput) {
              nameInput.style.borderColor = '#ef4444';
            }
            // é˜»æ­¢ Phone Number è¾“å…¥ï¼Œèšç„¦å› Name
            phoneInput.blur();
            setTimeout(() => {
              if (nameInput) {
                nameInput.focus();
              }
            }, 0);
            return;
          }
          
          // Name å·²å¡«å†™ï¼Œæ¸…é™¤ Name é”™è¯¯æç¤º
          const nameError = document.getElementById('blogLoginNameError');
          if (nameError) {
            nameError.style.display = 'none';
          }
          if (nameInput) {
            nameInput.style.borderColor = '#d1d5db';
          }
          
          let phone = phoneInput.value.replace(/\D/g, ''); // åªä¿ç•™æ•°å­—
          
          // å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯0ï¼Œè‡ªåŠ¨è¡¥0
          if (phone.length > 0 && phone[0] !== '0') {
            phone = '0' + phone.replace(/^0+/, ''); // å¦‚æœè¾“å…¥çš„ä¸æ˜¯0å¼€å¤´ï¼Œå¼ºåˆ¶ä»¥0å¼€å¤´
          }
          
          // é™åˆ¶æœ€å¤š11ä½
          if (phone.length > 11) {
            phone = phone.substring(0, 11);
          }
          
          phoneInput.value = phone;
          
          // æ£€æµ‹æ‰‹æœºå·æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆé•¿åº¦æˆ–æ•°å­—å˜åŒ–ï¼‰
          const phoneChanged = phone !== lastPhoneValue;
          lastPhoneValue = phone;
          
          // å¦‚æœæ‰‹æœºå·å‘ç”Ÿå˜åŒ–ï¼Œç«‹å³éšè—PINåŒºåŸŸ
          if (phoneChanged) {
            // ç«‹å³éšè—PINåŒºåŸŸ
            const pinSection = document.getElementById('blogPinSection');
            if (pinSection) {
              pinSection.style.display = 'none';
            }
            const pinConfirmSection = document.getElementById('blogPinConfirmSection');
            if (pinConfirmSection) {
              pinConfirmSection.style.display = 'none';
            }
            
            // æ¸…é™¤PINè¾“å…¥å’ŒçŠ¶æ€
            clearBlogPinInputs('both');
            blogLoginState.checkedPhone = '';
            blogLoginState.requiresPinSetup = false;
          }
          
          // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
          if (phoneError) {
            phoneError.style.display = 'none';
            phoneError.textContent = '';
          }
          phoneInput.style.borderColor = '#d1d5db';
          
          // æ¸…é™¤ä¹‹å‰çš„æ£€æŸ¥å®šæ—¶å™¨
          clearTimeout(phoneCheckTimeout);
          
          // åªæœ‰å½“è¾“å…¥å®Œæ•´çš„11ä½0å¼€å¤´æ•°å­—æ—¶ï¼Œæ‰æ£€æŸ¥PINçŠ¶æ€
          if (phone.length === 11 && phone.startsWith('0')) {
            phoneCheckTimeout = setTimeout(async () => {
              // å†æ¬¡éªŒè¯æ‰‹æœºå·æ˜¯å¦è¿˜æ˜¯11ä½0å¼€å¤´ï¼ˆé˜²æ­¢åœ¨å»¶è¿ŸæœŸé—´è¢«ä¿®æ”¹ï¼‰
              const currentPhone = phoneInput.value.trim();
              if (currentPhone.length === 11 && currentPhone.startsWith('0') && currentPhone === phone) {
                // å¦‚æœæ‰‹æœºå·æ”¹å˜äº†ï¼Œéœ€è¦é‡æ–°æ£€æŸ¥PINçŠ¶æ€
                if (blogLoginState.checkedPhone !== phone) {
                  // ç”Ÿæˆæ–°çš„è¯·æ±‚ID
                  const requestId = ++blogCheckPinStatusRequestId;
                  await checkBlogPinStatus(phone, requestId);
                }
              }
            }, 300);
          }
        });
        
        // å¤±å»ç„¦ç‚¹æ—¶éªŒè¯æ‰‹æœºå·æ ¼å¼
        phoneInput.addEventListener('blur', async () => {
          const phone = phoneInput.value.trim();
          
          if (phone) {
            // éªŒè¯æ‰‹æœºå·å¿…é¡»æ˜¯11ä½
            if (phone.length !== 11) {
              if (phoneError) {
                phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä¸º11ä½';
                phoneError.style.display = 'block';
              }
              phoneInput.style.borderColor = '#ef4444';
              // ç¡®ä¿PINåŒºåŸŸå·²éšè—
              const pinSection = document.getElementById('blogPinSection');
              if (pinSection) {
                pinSection.style.display = 'none';
              }
              return;
            }
            
            // éªŒè¯æ‰‹æœºå·å¿…é¡»ä»¥0å¼€å¤´
            if (!phone.startsWith('0')) {
              if (phoneError) {
                phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä»¥0å¼€å¤´';
                phoneError.style.display = 'block';
              }
              phoneInput.style.borderColor = '#ef4444';
              // ç¡®ä¿PINåŒºåŸŸå·²éšè—
              const pinSection = document.getElementById('blogPinSection');
              if (pinSection) {
                pinSection.style.display = 'none';
              }
              return;
            }
            
            // éªŒè¯æ‰‹æœºå·æ ¼å¼ï¼ˆåªå…è®¸æ•°å­—ï¼‰
            if (!/^\d{11}$/.test(phone)) {
              if (phoneError) {
                phoneError.textContent = 'æ‰‹æœºå·æ ¼å¼é”™è¯¯';
                phoneError.style.display = 'block';
              }
              phoneInput.style.borderColor = '#ef4444';
              // ç¡®ä¿PINåŒºåŸŸå·²éšè—
              const pinSection = document.getElementById('blogPinSection');
              if (pinSection) {
                pinSection.style.display = 'none';
              }
              return;
            }
            
            // æ ¼å¼æ­£ç¡®ï¼Œæ¸…é™¤é”™è¯¯æç¤º
            if (phoneError) {
              phoneError.style.display = 'none';
            }
            phoneInput.style.borderColor = '#d1d5db';
            
            // å¦‚æœæ‰‹æœºå·å®Œæ•´ä¸”æ­£ç¡®ï¼Œæ£€æŸ¥PINçŠ¶æ€
            if (phone.length === 11 && phone.startsWith('0')) {
              clearTimeout(phoneCheckTimeout);
              phoneCheckTimeout = setTimeout(async () => {
                // å†æ¬¡éªŒè¯æ‰‹æœºå·æ˜¯å¦è¿˜æ˜¯11ä½0å¼€å¤´ï¼ˆé˜²æ­¢åœ¨å»¶è¿ŸæœŸé—´è¢«ä¿®æ”¹ï¼‰
                const currentPhone = phoneInput.value.trim();
                if (currentPhone.length === 11 && currentPhone.startsWith('0') && currentPhone === phone) {
                  // å¦‚æœæ‰‹æœºå·æ”¹å˜äº†ï¼Œéœ€è¦é‡æ–°æ£€æŸ¥PINçŠ¶æ€
                  if (blogLoginState.checkedPhone !== phone) {
                    // ç”Ÿæˆæ–°çš„è¯·æ±‚ID
                    const requestId = ++blogCheckPinStatusRequestId;
                    await checkBlogPinStatus(phone, requestId);
                  }
                }
              }, 300);
            }
          } else {
            // æ‰‹æœºå·ä¸ºç©ºï¼Œç¡®ä¿PINåŒºåŸŸå·²éšè—
            const pinSection = document.getElementById('blogPinSection');
            if (pinSection) {
              pinSection.style.display = 'none';
            }
          }
        });
        
        // è·å¾—ç„¦ç‚¹æ—¶æ¸…é™¤é”™è¯¯æç¤º
        phoneInput.addEventListener('focus', () => {
          if (phoneError) {
            phoneError.style.display = 'none';
          }
          phoneInput.style.borderColor = '#d97706';
        });
      }
      
      // Name è¾“å…¥æ¡†äº‹ä»¶ç›‘å¬
      const nameInput = document.getElementById('blogLoginName');
      const nameError = document.getElementById('blogLoginNameError');
      
      if (nameInput) {
        // è·å¾—ç„¦ç‚¹æ—¶æ¸…é™¤é”™è¯¯æç¤º
        nameInput.addEventListener('focus', () => {
          if (nameError) {
            nameError.style.display = 'none';
          }
          nameInput.style.borderColor = '#d97706';
        });
        
        // è¾“å…¥æ—¶æ¸…é™¤é”™è¯¯æç¤º
        nameInput.addEventListener('input', () => {
          if (nameError) {
            nameError.style.display = 'none';
          }
          nameInput.style.borderColor = '#d1d5db';
        });
      }
    }

    // å¤„ç†ç™»å½•è¡¨å•æäº¤
    async function handleBlogLogin(event) {
      event.preventDefault();
      
      const name = document.getElementById('blogLoginName').value.trim();
      const phone = document.getElementById('blogLoginPhone').value.trim();
      const pinSection = document.getElementById('blogPinSection');
      const isPinVisible = pinSection && pinSection.style.display !== 'none';
      const pin = blogLoginState.pin;
      const pinConfirm = blogLoginState.pinConfirm;
      const submitBtn = document.getElementById('blogLoginSubmitBtn');
      
      // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
      const nameError = document.getElementById('blogLoginNameError');
      const phoneError = document.getElementById('blogLoginPhoneError');
      if (nameError) nameError.style.display = 'none';
      if (phoneError) phoneError.style.display = 'none';
      
      // éªŒè¯å§“å
      if (!name) {
        if (nameError) {
          nameError.textContent = 'è¯·è¾“å…¥å§“å';
          nameError.style.display = 'block';
        }
        document.getElementById('blogLoginName').focus();
        return;
      }
      
      // å¼ºåˆ¶è¦æ±‚PINï¼šå¦‚æœPINåŒºåŸŸä¸å¯è§ï¼Œéœ€è¦å…ˆæ£€æŸ¥PINçŠ¶æ€
      if (!isPinVisible) {
        // PINåŒºåŸŸä¸å¯è§ï¼Œéœ€è¦å…ˆæ£€æŸ¥PINçŠ¶æ€
        // éªŒè¯æ‰‹æœºå·å¿…é¡»æ˜¯11ä½0å¼€å¤´
        const phoneValid = phone && phone.length === 11 && phone.startsWith('0') && /^\d{11}$/.test(phone);
        if (phoneValid) {
          // ç”Ÿæˆæ–°çš„è¯·æ±‚ID
          const requestId = ++blogCheckPinStatusRequestId;
          const pinStatus = await checkBlogPinStatus(phone, requestId);
          if (pinStatus) {
            // éœ€è¦PINï¼Œä½†ç”¨æˆ·è¿˜æ²¡æœ‰è¾“å…¥ï¼Œæç¤ºç”¨æˆ·
            showToast('è¯·è¾“å…¥PINç ', 'info');
            return;
          }
        } else {
          // æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®
          if (!phone) {
            if (phoneError) {
              phoneError.textContent = 'è¯·è¾“å…¥æ‰‹æœºå·';
              phoneError.style.display = 'block';
            }
          } else if (phone.length !== 11) {
            if (phoneError) {
              phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä¸º11ä½';
              phoneError.style.display = 'block';
            }
          } else if (!phone.startsWith('0')) {
            if (phoneError) {
              phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä»¥0å¼€å¤´';
              phoneError.style.display = 'block';
            }
          } else {
            if (phoneError) {
              phoneError.textContent = 'æ‰‹æœºå·æ ¼å¼é”™è¯¯';
              phoneError.style.display = 'block';
            }
          }
          document.getElementById('blogLoginPhone').focus();
          return;
        }
      }
      
      // éªŒè¯æ‰‹æœºå·ï¼ˆå¿…é¡»æ˜¯11ä½0å¼€å¤´ï¼‰
      if (!phone) {
        if (phoneError) {
          phoneError.textContent = 'è¯·è¾“å…¥æ‰‹æœºå·';
          phoneError.style.display = 'block';
        }
        document.getElementById('blogLoginPhone').focus();
        return;
      }
      
      if (phone.length !== 11) {
        if (phoneError) {
          phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä¸º11ä½';
          phoneError.style.display = 'block';
        }
        document.getElementById('blogLoginPhone').focus();
        return;
      }
      
      if (!phone.startsWith('0')) {
        if (phoneError) {
          phoneError.textContent = 'æ‰‹æœºå·å¿…é¡»ä»¥0å¼€å¤´';
          phoneError.style.display = 'block';
        }
        document.getElementById('blogLoginPhone').focus();
        return;
      }
      
      if (!/^\d{11}$/.test(phone)) {
        if (phoneError) {
          phoneError.textContent = 'æ‰‹æœºå·æ ¼å¼é”™è¯¯';
          phoneError.style.display = 'block';
        }
        document.getElementById('blogLoginPhone').focus();
        return;
      }
      
      // å¦‚æœPINåŒºåŸŸå¯è§ï¼Œè¯´æ˜éœ€è¦PIN
      if (isPinVisible) {
        if (pin.length !== 4) {
          showToast('è¯·è¾“å…¥4ä½PINç ', 'error');
          showBlogPinError('pin');
          return;
        }
        
        // å¦‚æœæ˜¯è®¾ç½®PINæ¨¡å¼ï¼Œéœ€è¦ç¡®è®¤PIN
        const pinConfirmSection = document.getElementById('blogPinConfirmSection');
        if (pinConfirmSection && pinConfirmSection.style.display !== 'none') {
          if (pinConfirm.length !== 4) {
            showToast('è¯·ç¡®è®¤4ä½PINç ', 'error');
            showBlogPinError('pinConfirm');
            return;
          }
          
          if (pin !== pinConfirm) {
            showToast('PINç ä¸åŒ¹é…ï¼Œè¯·é‡æ–°è¾“å…¥', 'error');
            const mismatchError = document.getElementById('blogPinMismatchError');
            if (mismatchError) mismatchError.style.display = 'block';
            showBlogPinError('pinConfirm');
            clearBlogPinInputs('pinConfirm');
            return;
          }
        }
      } else {
        // PINåŒºåŸŸä¸å¯è§ï¼Œä½†å¯èƒ½ç”¨æˆ·æ²¡æœ‰PINï¼Œéœ€è¦å¼ºåˆ¶è¦æ±‚PIN
        if (!pin || pin.length !== 4) {
          showToast('è¯·è¾“å…¥PINç ', 'error');
          return;
        }
      }
      
      // è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'ç™»å½•ä¸­...';
        submitBtn.style.opacity = '0.6';
        submitBtn.style.cursor = 'not-allowed';
      }
      
      try {
        const response = await fetch(`${API_BASE}/auth/user/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ 
            phone, 
            name: name || undefined,
            pin: pin || undefined
          })
        });

        const data = await response.json();

        if (data.success) {
          blogCurrentUser = data.user;
          resetBlogLoginState();
          closeBlogLoginModal();
          updateBlogLoginStatus();
          showToast('ç™»å½•æˆåŠŸ', 'success');
          // åˆ·æ–°æ–‡ç« åˆ—è¡¨ä»¥æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
          if (viewMode === 'archive') {
            loadArchive();
          } else {
            loadPosts(currentPage || 1);
          }
        } else {
          // å¤„ç†é”™è¯¯
          let errorMessage = data.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•';
          
          // å¦‚æœæ˜¯PINç›¸å…³é”™è¯¯ï¼Œæ˜¾ç¤ºPINåŒºåŸŸ
          if (data.requiresPin || data.requiresPinSetup) {
            showBlogPinSection(data.requiresPinSetup);
            if (data.requiresPinSetup) {
              showToast('è¯·è®¾ç½®PINç ', 'info');
            } else {
              showToast('è¯·è¾“å…¥PINç ', 'info');
            }
            return;
          } else if (data.requiresCode) {
            errorMessage = 'æ­¤è´¦å·éœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼Œè¯·ä½¿ç”¨å°ç¨‹åºç™»å½•';
          }
          
          showToast(errorMessage, 'error');
          
          // å¦‚æœæ˜¯æ‰‹æœºå·é”™è¯¯ï¼Œé«˜äº®æ‰‹æœºå·è¾“å…¥æ¡†
          if (errorMessage.includes('æ‰‹æœº') || errorMessage.includes('phone')) {
            if (phoneError) {
              phoneError.textContent = errorMessage;
              phoneError.style.display = 'block';
            }
            document.getElementById('blogLoginPhone').focus();
          }
          
          // å¦‚æœæ˜¯PINé”™è¯¯ï¼Œé«˜äº®PINè¾“å…¥æ¡†
          if (errorMessage.includes('PIN') || errorMessage.includes('pin')) {
            clearBlogPinInputs('pin');
            const pin1 = document.getElementById('blogPin1');
            if (pin1) pin1.focus();
          }
        }
      } catch (error) {
        console.error('ç™»å½•å¤±è´¥:', error);
        showToast('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
      } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = 'ç™»å½•';
          submitBtn.style.opacity = '1';
          submitBtn.style.cursor = 'pointer';
        }
      }
    }

    // ç™»å‡º
    async function blogLogout() {
      try {
        const response = await fetch(`${API_BASE}/auth/user/logout`, {
          method: 'POST',
          credentials: 'include'
        });

        const data = await response.json();
        
        blogCurrentUser = null;
        updateBlogLoginStatus();
        showToast('å·²ç™»å‡º', 'success');
        // åˆ·æ–°æ–‡ç« åˆ—è¡¨ä»¥éšè—ç¼–è¾‘æŒ‰é’®
        loadPosts(currentPage || 1);
      } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error);
        // å³ä½¿APIè°ƒç”¨å¤±è´¥ï¼Œä¹Ÿæ¸…é™¤æœ¬åœ°çŠ¶æ€
        blogCurrentUser = null;
        updateBlogLoginStatus();
        showToast('å·²ç™»å‡º', 'success');
        // åˆ·æ–°æ–‡ç« åˆ—è¡¨ä»¥éšè—ç¼–è¾‘æŒ‰é’®
        loadPosts(currentPage || 1);
      }
    }

    // æ›´æ–°ç™»å½•çŠ¶æ€æ˜¾ç¤º
    function updateBlogLoginStatus() {
      const loginBtn = document.getElementById('blogLoginBtn');
      const userStatus = document.getElementById('userLoginStatus');
      const userNameDisplay = document.getElementById('userNameDisplay');
      const newPostBtn = document.getElementById('newPostBtn');
      const myPostsFilterBtn = document.getElementById('myPostsFilterBtn');
      
      if (blogCurrentUser) {
        // å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œç™»å‡ºæŒ‰é’®ã€æ–°å»ºæ–‡ç« æŒ‰é’®ã€ç­›é€‰æŒ‰é’®
        if (loginBtn) loginBtn.style.display = 'none';
        if (userStatus) userStatus.style.display = 'flex';
        if (userNameDisplay) {
          userNameDisplay.textContent = blogCurrentUser.name || blogCurrentUser.phone || 'ç”¨æˆ·';
        }
        if (newPostBtn) newPostBtn.style.display = 'inline-flex';
        if (myPostsFilterBtn) myPostsFilterBtn.style.display = 'inline-flex';
        // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
        updateMyPostsFilterButton();
      } else {
        // æœªç™»å½•ï¼šæ˜¾ç¤ºç™»å½•æŒ‰é’®ï¼Œéšè—æ–°å»ºæ–‡ç« æŒ‰é’®å’Œç­›é€‰æŒ‰é’®
        if (loginBtn) loginBtn.style.display = 'inline-flex';
        if (userStatus) userStatus.style.display = 'none';
        if (newPostBtn) newPostBtn.style.display = 'none';
        if (myPostsFilterBtn) myPostsFilterBtn.style.display = 'none';
        // é‡ç½®ç­›é€‰çŠ¶æ€
        showMyPostsOnly = false;
      }
    }
    
    // åˆ‡æ¢"æˆ‘çš„æ–‡ç« "ç­›é€‰
    function toggleMyPostsFilter() {
      if (!blogCurrentUser) {
        showToast('è¯·å…ˆç™»å½•', 'error');
        return;
      }
      
      showMyPostsOnly = !showMyPostsOnly;
      updateMyPostsFilterButton();
      
      // é‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨ï¼ˆé‡ç½®åˆ°ç¬¬ä¸€é¡µï¼‰
      currentPage = 1;
      loadPosts(1);
    }
    
    // æ›´æ–°"æˆ‘çš„æ–‡ç« "ç­›é€‰æŒ‰é’®çŠ¶æ€
    function updateMyPostsFilterButton() {
      const myPostsFilterBtn = document.getElementById('myPostsFilterBtn');
      const myPostsFilterIcon = document.getElementById('myPostsFilterIcon');
      const myPostsFilterText = document.getElementById('myPostsFilterText');
      
      if (!myPostsFilterBtn) return;
      
      if (showMyPostsOnly) {
        // æ¿€æ´»çŠ¶æ€ï¼šä½¿ç”¨ä¸»è‰²è°ƒ
        myPostsFilterBtn.style.background = 'linear-gradient(to right, #d97706, #f59e0b)';
        myPostsFilterBtn.style.color = 'white';
        myPostsFilterBtn.style.borderColor = '#d97706';
        if (myPostsFilterIcon) {
          myPostsFilterIcon.style.stroke = 'currentColor';
        }
        if (myPostsFilterText) {
          myPostsFilterText.textContent = 'æˆ‘çš„æ–‡ç«  âœ“';
        }
      } else {
        // æœªæ¿€æ´»çŠ¶æ€ï¼šä½¿ç”¨æ¬¡è¦æŒ‰é’®æ ·å¼
        myPostsFilterBtn.style.background = '';
        myPostsFilterBtn.style.color = '';
        myPostsFilterBtn.style.borderColor = '';
        if (myPostsFilterIcon) {
          myPostsFilterIcon.style.stroke = 'currentColor';
        }
        if (myPostsFilterText) {
          myPostsFilterText.textContent = 'æˆ‘çš„æ–‡ç« ';
        }
      }
    }

    // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    async function checkBlogUserAuth() {
      try {
        const response = await fetch(`${API_BASE}/auth/user/me`, {
          credentials: 'include',
          method: 'GET'
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data && data.success && data.user) {
            blogCurrentUser = data.user;
            updateBlogLoginStatus();
            return true;
          }
        }
        blogCurrentUser = null;
        updateBlogLoginStatus();
        return false;
      } catch (error) {
        console.error('æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€å¤±è´¥:', error);
        blogCurrentUser = null;
        updateBlogLoginStatus();
        return false;
      }
    }

    // æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
    async function checkAdminAuth() {
      try {
        const response = await fetch('/api/auth/admin/me', {
          credentials: 'include',
          method: 'GET'
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data && data.success && data.admin) {
            isAdminLoggedIn = true;
            // å¦‚æœå·²ç™»å½•ï¼Œæ›´æ–°UIæ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
            updateEditButtons();
            return true;
          }
        }
        isAdminLoggedIn = false;
        return false;
      } catch (error) {
        console.error('æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€å¤±è´¥:', error);
        isAdminLoggedIn = false;
        return false;
      }
    }

    // ç¼–è¾‘æ–‡ç« ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰
    function editPost(postId) {
      // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜ç™»å½•ï¼Œæˆ–è€…ç”¨æˆ·æ˜¯å¦æœ‰ç¼–è¾‘æƒé™
      // æ³¨æ„ï¼šè¿™é‡Œåªæ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€ï¼Œæ™®é€šç”¨æˆ·çš„canEditæƒé™åœ¨æ¸²æŸ“æ—¶å·²ç»åˆ¤æ–­
      // å¦‚æœæ™®é€šç”¨æˆ·ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œè¯´æ˜è¯¥æ–‡ç« æœ‰canEditæƒé™ï¼Œå…è®¸ç¼–è¾‘
      if (!isAdminLoggedIn && !blogCurrentUser) {
        // å¦‚æœæœªç™»å½•ï¼Œè·³è½¬åˆ°ç®¡ç†ç•Œé¢ç™»å½•
        window.location.href = '/blog-admin.html';
        return;
      }
      
      // åœ¨æ–°çª—å£æ‰“å¼€ç¼–è¾‘é¡µé¢
      const editUrl = `/blog-admin.html?edit=${encodeURIComponent(postId)}`;
      const editWindow = window.open(editUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
      
      if (!editWindow) {
        showToast('æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®', 'error');
        return;
      }
      
      // ç›‘å¬æ–°çª—å£å…³é—­äº‹ä»¶ï¼Œåˆ·æ–°æ–‡ç« åˆ—è¡¨
      const checkClosed = setInterval(() => {
        if (editWindow.closed) {
          clearInterval(checkClosed);
          // åˆ·æ–°æ–‡ç« åˆ—è¡¨ï¼ˆæ ¹æ®å½“å‰è§†å›¾æ¨¡å¼ï¼‰
          loadPosts(1);
        }
      }, 500);
    }

    // æ–°å»ºæ–‡ç« ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰
    function newPost() {
      // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
      if (!blogCurrentUser) {
        showToast('è¯·å…ˆç™»å½•', 'error');
        showBlogLoginModal();
        return;
      }
      
      // åœ¨æ–°çª—å£æ‰“å¼€æ–°å»ºæ–‡ç« é¡µé¢
      const newUrl = `/blog-admin.html?action=new`;
      const newWindow = window.open(newUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
      
      if (!newWindow) {
        showToast('æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®', 'error');
        return;
      }
      
      // ç›‘å¬æ–°çª—å£å…³é—­äº‹ä»¶ï¼Œåˆ·æ–°æ–‡ç« åˆ—è¡¨
      const checkClosed = setInterval(() => {
        if (newWindow.closed) {
          clearInterval(checkClosed);
          // åˆ·æ–°æ–‡ç« åˆ—è¡¨ï¼ˆæ ¹æ®å½“å‰è§†å›¾æ¨¡å¼ï¼‰
          loadPosts(1);
        }
      }, 500);
    }

    // åˆ é™¤æ–‡ç« ï¼ˆä½¿ç”¨å°ç¨‹åºAPIï¼‰
    async function deletePost(postId) {
      // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜ç™»å½•ï¼Œæˆ–è€…ç”¨æˆ·æ˜¯å¦æœ‰ç¼–è¾‘æƒé™
      if (!isAdminLoggedIn && !blogCurrentUser) {
        showToast('è¯·å…ˆç™»å½•', 'error');
        return;
      }
      
      // ç¡®è®¤åˆ é™¤
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/blog-admin/posts/${postId}`, {
          method: 'DELETE',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          showToast('æ–‡ç« åˆ é™¤æˆåŠŸ', 'success');
          // åˆ·æ–°æ–‡ç« åˆ—è¡¨
          loadPosts(1);
        } else {
          showToast(data.message || 'åˆ é™¤å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('åˆ é™¤æ–‡ç« å¤±è´¥:', error);
        showToast('åˆ é™¤å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
      }
    }

    // æ›´æ–°ç¼–è¾‘æŒ‰é’®æ˜¾ç¤º
    function updateEditButtons() {
      if (!isAdminLoggedIn) {
        // å¦‚æœæœªç™»å½•ï¼Œéšè—æ‰€æœ‰ç¼–è¾‘æŒ‰é’®
        document.querySelectorAll('.blog-post-edit-btn').forEach(btn => {
          btn.style.display = 'none';
        });
        return;
      }
      
      // æ›´æ–°æ–‡ç« å¡ç‰‡ä¸­çš„ç¼–è¾‘æŒ‰é’®
      document.querySelectorAll('.blog-post-edit-btn').forEach(btn => {
        btn.style.display = 'inline-flex';
      });
    }

    // åŠ è½½çƒ­é—¨æ–‡ç« ï¼ˆæŒ‰æµè§ˆé‡æ’åºï¼‰
    async function loadHotPosts() {
      try {
        const response = await getPosts({
          published: 'true',
          pageSize: 20 // è·å–æ›´å¤šæ–‡ç« ä»¥ä¾¿æ’åº
        });
        
        if (response.success && response.data) {
          const hotPostsList = document.getElementById('hotPostsList');
          if (hotPostsList) {
            // æŒ‰æµè§ˆé‡æ’åºï¼Œå–å‰5ç¯‡
            const sortedPosts = [...(response.data || [])]
              .sort((a, b) => (b.views || 0) - (a.views || 0))
              .slice(0, 5);
            
            if (sortedPosts.length === 0) {
              hotPostsList.innerHTML = '<p style="font-size: 0.8125rem; color: #9ca3af; margin: 0;">æš‚æ— çƒ­é—¨æ–‡ç« </p>';
              return;
            }
            
            hotPostsList.innerHTML = sortedPosts.map((post, index) => {
              const views = post.views || 0;
              return `
                <a href="/blog-detail.html?slug=${encodeURIComponent(post.slug)}" style="display: flex; align-items: start; gap: 0.5rem; padding: 0.375rem; border-radius: 0.25rem; text-decoration: none; transition: background 0.2s; width: 100%; box-sizing: border-box;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='transparent'">
                  <span style="flex-shrink: 0; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; background: ${index < 3 ? '#fef3c7' : '#f3f4f6'}; color: ${index < 3 ? '#d97706' : '#6b7280'}; border-radius: 0.25rem; font-size: 0.6875rem; font-weight: 600; text-align: center; line-height: 1;">${index + 1}</span>
                  <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 0.125rem;">
                    <div style="font-size: 0.75rem; font-weight: 500; color: #374151; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-align: left; word-break: break-word;">${escapeHtml(post.name || post.title || 'æœªå‘½å')}</div>
                    <div style="font-size: 0.6875rem; color: #9ca3af; text-align: left; white-space: nowrap;">ğŸ‘ï¸ ${views}</div>
                  </div>
                </a>
              `;
            }).join('');
          }
        }
      } catch (error) {
        console.error('åŠ è½½çƒ­é—¨æ–‡ç« å¤±è´¥:', error);
        const hotPostsList = document.getElementById('hotPostsList');
        if (hotPostsList) {
          hotPostsList.innerHTML = '<p style="font-size: 0.8125rem; color: #9ca3af; margin: 0;">åŠ è½½å¤±è´¥</p>';
        }
      }
    }
    
    // å¼ºåˆ¶è®¾ç½®åˆ—è¡¨å¸ƒå±€çš„å‡½æ•°ï¼ˆè®ºå›é£æ ¼ï¼‰
    function forceGridLayout() {
      const grid = document.getElementById('postsGrid');
      if (!grid) return;
      
      // ç¡®ä¿åˆ—è¡¨å¸ƒå±€
      grid.style.setProperty('display', 'flex', 'important');
      grid.style.setProperty('flex-direction', 'column', 'important');
      grid.style.setProperty('gap', '0', 'important');
      grid.style.setProperty('width', '100%', 'important');
      grid.style.setProperty('max-width', '100%', 'important');
      grid.style.setProperty('box-sizing', 'border-box', 'important');
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      initParticles();
      
      // åˆå§‹åŒ–ç™»å½•ç›¸å…³å¤„ç†å™¨ï¼ˆPINè¾“å…¥æ¡†å’Œæ‰‹æœºå·ç›‘å¬ï¼‰
      initBlogLoginHandlers();
      
      // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
      await checkBlogUserAuth();
      
      // æ£€æŸ¥ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
      await checkAdminAuth();
      
      // å¼ºåˆ¶è®¾ç½®ç½‘æ ¼å¸ƒå±€
      forceGridLayout();
      
      loadPosts(1);
      loadCategories();
      loadHotPosts();
      
      // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¾ç½®å¸ƒå±€
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          forceGridLayout();
        }, 100);
      });
      
      // æµè§ˆæ–‡ç« æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      document.querySelector('a[href="#posts"]')?.addEventListener('click', (e) => {
        e.preventDefault();
        switchViewMode('posts');
        document.getElementById('posts').scrollIntoView({ behavior: 'smooth' });
        setTimeout(forceGridLayout, 100);
      });

    });
  </script>
</body>
</html>
