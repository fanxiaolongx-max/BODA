# 完整更新步骤

## 🎯 新功能说明

系统已升级支持：
1. ✅ **杯型选择** - Medium中杯/Large大杯，不同价格
2. ✅ **甜度选择** - 无糖/微糖/半糖/少糖/标准 (0%/30%/50%/70%/100%)
3. ✅ **加料选择** - 芝士/果冻/波霸/奶盖 (各20 EGP)
4. ✅ **参考专业外卖APP设计** - 仿照美团/饿了么界面
5. ✅ **合并相同商品** - 从53个减少到37个
6. ✅ **实时价格计算** - 基础价格 + 加料价格

---

## 🚀 执行步骤（按顺序）

### 第1步：迁移products表

```bash
cd /Volumes/512G/06-工具开发/BODA
node db/migrate-products.js
```

**作用**：为products表添加 sizes, sugar_levels, available_toppings 字段

---

### 第2步：迁移order_items表

```bash
node db/migrate-order-items.js
```

**作用**：为order_items表添加 size, sugar_level, toppings 字段

---

### 第3步：更新菜单数据

```bash
node db/update-menu-v2.js
```

**作用**：
- 删除所有旧菜单和订单
- 创建9个新分类
- 添加37个菜品（已合并相同名称）
- 配置杯型、甜度、加料选项

---

### 第4步：重启服务器

```bash
npm start
```

---

## 📋 更新内容

### 数据库变化

**products表**：
- ✅ `sizes` - JSON格式: `{"Medium 中杯": 120, "Large 大杯": 150}`
- ✅ `sugar_levels` - JSON格式: `["0", "30", "50", "70", "100"]`
- ✅ `available_toppings` - JSON格式: `[1, 2, 3, 4]`

**order_items表**：
- ✅ `size` - 用户选择的杯型
- ✅ `sugar_level` - 用户选择的甜度
- ✅ `toppings` - 用户选择的加料（JSON）

### 菜单变化

**合并前**（53个商品）：
```
Creamy Matcha 奶香抹茶（中杯）- 120 EGP
Creamy Matcha 奶香抹茶（大杯）- 150 EGP
```

**合并后**（37个商品）：
```
Creamy Matcha 奶香抹茶
├─ Medium 中杯: 120 EGP
└─ Large 大杯: 150 EGP
```

### 界面变化

**商品列表页**：
```
┌─────────────────────────┐
│  [商品图片]              │
│                         │
│  Creamy Matcha         │
│  奶香抹茶               │
│                         │
│  ¥120 起    [选规格]    │
└─────────────────────────┘
```

**商品详情弹窗**：
```
┌─────────────────────────────────┐
│ Creamy Matcha 奶香抹茶      [×] │
├─────────────────────────────────┤
│ 规格                             │
│ [Medium 中杯 ¥120] [Large 大杯 ¥150] │
│                                  │
│ 甜度                             │
│ [无糖 0%] [微糖 30%] [半糖 50%]  │
│ [少糖 70%] [标准 100% (推荐)]   │
│                                  │
│ 加料（可多选）                   │
│ □ Cheese 芝士      +¥20         │
│ □ Jelly 果冻       +¥20         │
│ □ Boba 波霸        +¥20         │
│ □ Cream 奶盖       +¥20         │
│                                  │
│ [-] 1 [+]          总计 ¥150    │
│                                  │
│      [加入购物车]                │
└─────────────────────────────────┘
```

**购物车显示**：
```
┌─────────────────────────────────┐
│ Creamy Matcha 奶香抹茶      [×] │
│ 规格: Large 大杯                │
│ 甜度: 半糖                       │
│ 加料: Jelly 果冻, Boba 波霸     │
│                                  │
│ ¥150 + ¥40 = ¥190              │
│                [-] 1 [+]        │
└─────────────────────────────────┘
```

---

## ✅ 功能验证

更新后测试以下功能：

### 1. 商品列表
- [ ] 显示"¥XX 起"（有多杯型的商品）
- [ ] 显示"选规格"按钮
- [ ] 按分类筛选正常

### 2. 商品详情
- [ ] 点击"选规格"弹出详情页
- [ ] 可以选择杯型
- [ ] 可以选择甜度
- [ ] 可以多选加料
- [ ] 价格实时更新

### 3. 购物车
- [ ] 显示完整配置（杯型/甜度/加料）
- [ ] 价格计算正确
- [ ] 可以修改数量
- [ ] 可以删除商品

### 4. 提交订单
- [ ] 订单包含完整配置
- [ ] 价格计算正确
- [ ] 订单详情显示配置信息

---

## 🎨 UI改进

参考专业外卖APP：

### 配色方案
- **主色调**：黄色（#FBBF24）- 符合奶茶店氛围
- **强调色**：橙色渐变
- **价格颜色**：红色（#EF4444）- 突出显示
- **按钮**：黄色渐变

### 设计元素
- ✅ 圆角卡片
- ✅ 阴影效果
- ✅ 平滑过渡动画
- ✅ 响应式布局
- ✅ 选中状态高亮（黄色边框）

---

## 📝 新菜单概览

### 分类（9个）
1. TOP DRINKS 人气推荐 (3个)
2. FRESH FRUIT TEA 鲜果水果茶 (5个)
3. BOBA MILKSHAKE 波霸奶昔 (5个)
4. COCOA 可可系列 (4个)
5. MATCHA 抹茶系列 (4个)
6. CREAMY TEA 奶盖茶 (4个)
7. BOBO MILK TEA 波波奶茶 (4个)
8. LEMON TEA 柠檬茶 (4个)
9. COFFEE 咖啡系列 (4个)

### 菜品（37个 + 4个加料）
- 所有饮品都支持甜度选择
- 大部分饮品支持杯型选择
- 所有饮品都可添加加料

---

## ⚠️ 重要提示

### 数据影响
运行更新脚本会**删除所有旧订单和菜品**！

如需保留：
```bash
cp db/boda.db db/boda.db.backup
```

### 新功能限制
- 甜度和加料在数据库中已配置
- 前端界面已实现
- 后端API已支持
- 订单会保存完整配置信息

---

## 🔧 执行命令

**完整命令序列**：

```bash
cd /Volumes/512G/06-工具开发/BODA

# 迁移products表
node db/migrate-products.js

# 迁移order_items表
node db/migrate-order-items.js

# 更新菜单数据
node db/update-menu-v2.js

# 重启服务器
npm start
```

---

## 🎉 预期效果

更新后您将看到：

1. **用户端**：
   - 商品卡片显示"¥120 起"
   - 点击"选规格"弹出详情页
   - 可选择杯型、甜度、加料
   - 实时显示价格

2. **购物车**：
   - 显示完整配置信息
   - 价格分项显示（基础 + 加料）

3. **订单**：
   - 保存用户选择的所有配置
   - 管理员可看到详细配置

---

现在请按顺序执行这4个命令，然后测试新功能！🎉

